
/* /web_editor/static/lib/nearest/jquery.nearest.js defined in bundle 'web_editor.assets_editor' */
;(function($,undefined){var rPerc=/^([\d.]+)%$/;function nearest(selector,options,thisObj){selector||(selector='div');var $container=$(options.container),containerOffset=$container.offset()||{left:0,top:0},containerDims=[containerOffset.left+$container.width(),containerOffset.top+$container.height()],percProps={x:0,y:1,w:0,h:1},prop,match;for(prop in percProps)if(percProps.hasOwnProperty(prop)){match=rPerc.exec(options[prop]);if(match){options[prop]=containerDims[percProps[prop]]*match[1]/100;}}
var $all=$(selector),cache=[],furthest=!!options.furthest,checkX=!!options.checkHoriz,checkY=!!options.checkVert,compDist=furthest?0:Infinity,point1x=parseFloat(options.x)||0,point1y=parseFloat(options.y)||0,point2x=parseFloat(point1x+options.w)||point1x,point2y=parseFloat(point1y+options.h)||point1y,tolerance=options.tolerance||0,hasEach2=!!$.fn.each2,min=Math.min,max=Math.max;if(!options.includeSelf&&thisObj){$all=$all.not(thisObj);}
if(tolerance<0){tolerance=0;}
$all[hasEach2?'each2':'each'](function(i,elem){var $this=hasEach2?elem:$(this),off=$this.offset(),x=off.left,y=off.top,w=$this.outerWidth(),h=$this.outerHeight(),x2=x+w,y2=y+h,maxX1=max(x,point1x),minX2=min(x2,point2x),maxY1=max(y,point1y),minY2=min(y2,point2y),intersectX=minX2>=maxX1,intersectY=minY2>=maxY1,distX,distY,distT,isValid;if((checkX&&checkY)||(!checkX&&!checkY&&intersectX&&intersectY)||(checkX&&intersectY)||(checkY&&intersectX)){distX=intersectX?0:maxX1-minX2;distY=intersectY?0:maxY1-minY2;distT=intersectX||intersectY?max(distX,distY):Math.sqrt(distX*distX+distY*distY);isValid=furthest?distT>=compDist-tolerance:distT<=compDist+tolerance;if(isValid){compDist=furthest?max(compDist,distT):min(compDist,distT);cache.push({node:this,dist:distT});}}});var len=cache.length,filtered=[],compMin,compMax,i,item;if(len){if(furthest){compMin=compDist-tolerance;compMax=compDist;}else{compMin=compDist;compMax=compDist+tolerance;}
for(i=0;i<len;i++){item=cache[i];if(item.dist>=compMin&&item.dist<=compMax){filtered.push(item.node);}}}
return filtered;}
$.each(['nearest','furthest','touching'],function(i,name){var defaults={x:0,y:0,w:0,h:0,tolerance:1,container:document,furthest:name=='furthest',includeSelf:false,checkHoriz:name!='touching',checkVert:name!='touching'};$[name]=function(point,selector,options){if(!point||point.x===undefined||point.y===undefined){return $([]);}
var opts=$.extend({},defaults,point,options||{});return $(nearest(selector,opts));};$.fn[name]=function(selector,options){var opts;if(selector&&$.isPlainObject(selector)){opts=$.extend({},defaults,selector,options||{});return this.pushStack(nearest(this,opts));}
var offset=this.offset(),dimensions={x:offset.left,y:offset.top,w:this.outerWidth(),h:this.outerHeight()};opts=$.extend({},defaults,dimensions,options||{});return this.pushStack(nearest(selector,opts,this));};});})(jQuery);;

/* /web_editor/static/src/js/editor/editor.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.editor',function(require){'use strict';var Dialog=require('web.Dialog');var Widget=require('web.Widget');var core=require('web.core');var rte=require('web_editor.rte');var snippetsEditor=require('web_editor.snippet.editor');var _t=core._t;var EditorMenuBar=Widget.extend({template:'web_editor.editorbar',xmlDependencies:['/web_editor/static/src/xml/editor.xml'],events:{'click button[data-action=save]':'_onSaveClick','click button[data-action=cancel]':'_onCancelClick',},custom_events:{request_history_undo_record:'_onHistoryUndoRecordRequest',request_save:'_onSaveRequest',},init:function(parent){var self=this;var res=this._super.apply(this,arguments);this.rte=new rte.Class(this);this.rte.on('rte:start',this,function(){self.trigger('rte:start');});var $editable=this.rte.editable();window.__EditorMenuBar_$editable=$editable;this.snippetsMenu=new snippetsEditor.Class(this,$editable);return res;},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];core.bus.on('editor_save_request',this,this.save);core.bus.on('editor_discard_request',this,this.cancel);$('.dropdown-toggle').dropdown();$(document).on('keyup',function(event){if((event.keyCode===8||event.keyCode===46)){var $target=$(event.target).closest('.o_editable');if(!$target.is(':has(*:not(p):not(br))')&&!$target.text().match(/\S/)){$target.empty();}}});$(document).on('click','.note-editable',function(ev){ev.preventDefault();});$(document).on('submit','.note-editable form .btn',function(ev){ev.preventDefault();});$(document).on('hide.bs.dropdown','.dropdown',function(ev){if(ev.originalEvent&&$(ev.target).has(ev.originalEvent.target).length&&$(ev.originalEvent.target).is('[contenteditable]')){ev.preventDefault();}});this.rte.start();var flag=false;window.onbeforeunload=function(event){if(rte.history.getEditableHasUndo().length&&!flag){flag=true;_.defer(function(){flag=false;});return _t('This document is not saved!');}};defs.push(this.snippetsMenu.insertAfter(this.$el));this.rte.editable().find('*').off('mousedown mouseup click');return $.when.apply($,defs).then(function(){self.trigger_up('edit_mode');});},destroy:function(){this._super.apply(this,arguments);core.bus.off('editor_save_request',this,this._onSaveRequest);core.bus.off('editor_discard_request',this,this._onDiscardRequest);},cancel:function(reload){var self=this;var def=$.Deferred();if(!rte.history.getEditableHasUndo().length){def.resolve();}else{var confirm=Dialog.confirm(this,_t("If you discard the current edition, all unsaved changes will be lost. You can cancel to return to the edition mode."),{confirm_callback:def.resolve.bind(def),});confirm.on('closed',def,def.reject);}
return def.then(function(){if(reload!==false){window.onbeforeunload=null;return self._reload();}});},save:function(reload){var self=this;var defs=[];this.trigger_up('ready_to_save',{defs:defs});return $.when.apply($,defs).then(function(){self.snippetsMenu.cleanForSave();return self._saveCroppedImages();}).then(function(){return self.rte.save();}).then(function(){if(reload!==false){return self._reload();}});},_reload:function(){window.location.hash='scrollTop='+window.document.body.scrollTop;if(window.location.search.indexOf('enable_editor')>=0){window.location.href=window.location.href.replace(/&?enable_editor(=[^&]*)?/g,'');}else{window.location.reload(true);}
return $.Deferred();},_saveCroppedImages:function(){return this.rte.saveCroppedImages(this.rte.editable());},_onCancelClick:function(){this.cancel();},_onHistoryUndoRecordRequest:function(ev){this.rte.historyRecordUndo(ev.data.$target,ev.data.event);},_onSaveClick:function(){this.save();},_onDiscardRequest:function(ev){this.cancel(ev.data.reload).then(ev.data.onSuccess,ev.data.onFailure);},_onSaveRequest:function(ev){ev.stopPropagation();this.save(ev.data.reload).then(ev.data.onSuccess,ev.data.onFailure);},});return{Class:EditorMenuBar,};});;

/* /web_editor/static/src/js/editor/rte.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.rte',function(require){'use strict';var base=require('web_editor.base');var concurrency=require('web.concurrency');var core=require('web.core');var Widget=require('web.Widget');var weContext=require('web_editor.context');var summernote=require('web_editor.summernote');var summernoteCustomColors=require('web_editor.rte.summernote_custom_colors');var _t=core._t;var dom=summernote.core.dom;var range=summernote.core.range;var History=function History($editable){var aUndo=[];var pos=0;var toSnap;this.makeSnap=function(event,rng){rng=rng||range.create();var elEditable=$(rng&&rng.sc).closest('.o_editable')[0];if(!elEditable){return false;}
return{event:event,editable:elEditable,contents:elEditable.innerHTML,bookmark:rng&&rng.bookmark(elEditable),scrollTop:$(elEditable).scrollTop()};};this.applySnap=function(oSnap){var $editable=$(oSnap.editable);if(document.documentMode){$editable.removeAttr('contentEditable').removeProp('contentEditable');}
$editable.trigger('content_will_be_destroyed');var $tempDiv=$('<div/>',{html:oSnap.contents});_.each($tempDiv.find('.o_temp_auto_element'),function(el){var $el=$(el);var originalContent=$el.attr('data-temp-auto-element-original-content');if(originalContent){$el.after(originalContent);}
$el.remove();});$editable.html($tempDiv.html()).scrollTop(oSnap.scrollTop);$editable.trigger('content_was_recreated');$('.oe_overlay').remove();$('.note-control-selection').hide();$editable.trigger('content_changed');try{var r=oSnap.editable.innerHTML===''?range.create(oSnap.editable,0):range.createFromBookmark(oSnap.editable,oSnap.bookmark);r.select();}catch(e){console.error(e);return;}
$(document).trigger('click');$('.o_editable *').filter(function(){var $el=$(this);if($el.data('snippet-editor')){$el.removeData();}});_.defer(function(){var target=dom.isBR(r.sc)?r.sc.parentNode:dom.node(r.sc);if(!target){return;}
$editable.trigger('applySnap');var evt=document.createEvent('MouseEvents');evt.initMouseEvent('click',true,true,window,0,0,0,0,0,false,false,false,false,0,target);target.dispatchEvent(evt);$editable.trigger('keyup');});};this.undo=function(){if(!pos){return;}
var _toSnap=toSnap;if(_toSnap){this.saveSnap();}
if(!aUndo[pos]&&(!aUndo[pos]||aUndo[pos].event!=='undo')){var temp=this.makeSnap('undo');if(temp&&(!pos||temp.contents!==aUndo[pos-1].contents)){aUndo[pos]=temp;}else{pos--;}}else if(_toSnap){pos--;}
this.applySnap(aUndo[Math.max(--pos,0)]);while(pos&&(aUndo[pos].event==='blur'||(aUndo[pos+1].editable===aUndo[pos].editable&&aUndo[pos+1].contents===aUndo[pos].contents))){this.applySnap(aUndo[--pos]);}};this.hasUndo=function(){return(toSnap&&(toSnap.event!=='blur'&&toSnap.event!=='activate'&&toSnap.event!=='undo'))||!!_.find(aUndo.slice(0,pos+1),function(undo){return undo.event!=='blur'&&undo.event!=='activate'&&undo.event!=='undo';});};this.getEditableHasUndo=function(){var editable=[];if((toSnap&&(toSnap.event!=='blur'&&toSnap.event!=='activate'&&toSnap.event!=='undo'))){editable.push(toSnap.editable);}
_.each(aUndo.slice(0,pos+1),function(undo){if(undo.event!=='blur'&&undo.event!=='activate'&&undo.event!=='undo'){editable.push(undo.editable);}});return _.uniq(editable);};this.redo=function(){if(!aUndo[pos+1]){return;}
this.applySnap(aUndo[++pos]);while(aUndo[pos+1]&&aUndo[pos].event==='active'){this.applySnap(aUndo[pos++]);}};this.hasRedo=function(){return aUndo.length>pos+1;};this.recordUndo=function($editable,event,internal_history){var self=this;if(!$editable){var rng=range.create();if(!rng)return;$editable=$(rng.sc).closest('.o_editable');}
if(aUndo[pos]&&(event==='applySnap'||event==='activate')){return;}
if(!internal_history){if(!event||!toSnap||!aUndo[pos-1]||toSnap.event==='activate'){setTimeout(function(){$editable.trigger('content_changed');},0);}}
if(aUndo[pos]){pos=Math.min(pos,aUndo.length);aUndo.splice(pos,aUndo.length);}
if(toSnap&&(toSnap.split||!event||toSnap.event!==event||toSnap.editable!==$editable[0])){this.saveSnap();}
if(pos&&aUndo[pos-1].editable!==$editable[0]){var snap=this.makeSnap('blur',range.create(aUndo[pos-1].editable,0));pos++;aUndo.push(snap);}
if(range.create()){toSnap=self.makeSnap(event);}else{toSnap=false;}};this.splitNext=function(){if(toSnap){toSnap.split=true;}};this.saveSnap=function(){if(toSnap){if(!aUndo[pos]){pos++;}
aUndo.push(toSnap);delete toSnap.split;toSnap=null;}};};var history=new History();$.extend($.expr[':'],{o_editable:function(node,i,m){while(node){if(node.className&&_.isString(node.className)){if(node.className.indexOf('o_not_editable')!==-1){return false;}
if(node.className.indexOf('o_editable')!==-1){return true;}}
node=node.parentNode;}
return false;},});$.fn.extend({focusIn:function(){if(this.length){range.create(dom.firstChild(this[0]),0).select();}
return this;},focusInEnd:function(){if(this.length){var last=dom.lastChild(this[0]);range.create(last,dom.nodeLength(last)).select();}
return this;},selectContent:function(){if(this.length){var next=dom.lastChild(this[0]);range.create(dom.firstChild(this[0]),0,next,next.textContent.length).select();}
return this;},});var RTEWidget=Widget.extend({init:function(parent,getConfig){var self=this;this._super.apply(this,arguments);this.init_bootstrap_carousel=$.fn.carousel;this.edit_bootstrap_carousel=function(){var res=self.init_bootstrap_carousel.apply(this,arguments);$(this).off('keydown.bs.carousel');return res;};this._getConfig=getConfig||this._getDefaultConfig;base.computeFonts();},start:function(){var self=this;this.saving_mutex=new concurrency.Mutex();$.fn.carousel=this.edit_bootstrap_carousel;$(document).on('click.rte keyup.rte',function(){var current_range={};try{current_range=range.create()||{};}catch(e){}
var $popover=$(current_range.sc).closest('[contenteditable]');var popover_history=($popover.data()||{}).NoteHistory;if(!popover_history||popover_history===history)return;var editor=$popover.parent('.note-editor');$('button[data-event="undo"]',editor).attr('disabled',!popover_history.hasUndo());$('button[data-event="redo"]',editor).attr('disabled',!popover_history.hasRedo());});$(document).on('mousedown.rte activate.rte',this,this._onMousedown.bind(this));$(document).on('mouseup.rte',this,this._onMouseup.bind(this));$('.o_not_editable').attr('contentEditable',false);var $editable=this.editable();$editable.on('content_will_be_destroyed',function(ev){self.trigger_up('content_will_be_destroyed',{$target:$(ev.currentTarget),});});$editable.on('content_was_recreated',function(ev){self.trigger_up('content_was_recreated',{$target:$(ev.currentTarget),});});$editable.addClass('o_editable').data('rte',this).each(function(){var $node=$(this);var computedStyles=window.getComputedStyle(this)||window.parent.getComputedStyle(this);if(computedStyles.display==='inline'&&$node.data('oe-type')!=='image'){$node.addClass('o_is_inline_editable');}});$(document).on('content_changed','.o_editable',function(ev){self.trigger_up('rte_change',{target:ev.target});if(!ev.__isDirtyHandled){$(this).addClass('o_dirty');ev.__isDirtyHandled=true;}});$('#wrapwrap, .o_editable').on('click.rte','*',this,this._onClick.bind(this));$('body').addClass('editor_enable');$(document.body).tooltip({selector:'[data-oe-readonly]',container:'body',trigger:'hover',delay:{'show':1000,'hide':100},placement:'bottom',title:_t("Readonly field")}).on('click',function(){$(this).tooltip('hide');});$(document).trigger('mousedown');this.trigger('rte:start');return this._super.apply(this,arguments);},destroy:function(){this.cancel();this._super.apply(this,arguments);},cancel:function(){if(this.$last){this.$last.destroy();this.$last=null;}
$.fn.carousel=this.init_bootstrap_carousel;$(document).off('.rte');$('#wrapwrap, .o_editable').off('.rte');$('.o_not_editable').removeAttr('contentEditable');$(document).off('click.rte keyup.rte mousedown.rte activate.rte mouseup.rte');$(document).off('content_changed').removeClass('o_is_inline_editable').removeData('rte');$(document).tooltip('dispose');$('body').removeClass('editor_enable');this.trigger('rte:stop');},editable:function(){return $('#wrapwrap [data-oe-model]').not('.o_not_editable').filter(function(){return!$(this).closest('.o_not_editable').length;}).not('link, script').not('[data-oe-readonly]').not('img[data-oe-field="arch"], br[data-oe-field="arch"], input[data-oe-field="arch"]').not('.oe_snippet_editor').add('.o_editable');},historyRecordUndo:function($target,event,internal_history){$target=$($target);var rng=range.create();var $editable=$(rng&&rng.sc).closest('.o_editable');if(!rng||!$editable.length){$editable=$target.closest('.o_editable');rng=range.create($target.closest('*')[0],0);}else{rng=$editable.data('range')||rng;}
try{rng.select();}catch(e){console.log('error',e);}
history.recordUndo($editable,event,internal_history);},save:function(context){var self=this;$('.o_editable').destroy().removeClass('o_editable o_is_inline_editable o_editable_date_field_linked o_editable_date_field_format_changed');var $dirty=$('.o_dirty');$dirty.removeAttr('contentEditable').removeClass('o_dirty oe_carlos_danger o_is_inline_editable');var defs=_.map($dirty,function(el){var $el=$(el);$el.find('[class]').filter(function(){if(!this.getAttribute('class').match(/\S/)){this.removeAttribute('class');}});return self.saving_mutex.exec(function(){return self._saveElement($el,context||weContext.get()).then(function(){$el.removeClass('o_dirty');},function(response){var id=_.uniqueId('carlos_danger_');$el.addClass('o_dirty oe_carlos_danger '+id);var html=(response.data.exception_type==='except_osv');if(html){var msg=$('<div/>',{text:response.data.message}).html();var data=msg.substring(3,msg.length-2).split(/', u'/);response.data.message='<b>'+data[0]+'</b>'+data[1];}
$('.o_editable.'+id).removeClass(id).popover({html:html,trigger:'hover',content:response.data.message,placement:'auto top',}).popover('show');});});});return $.when.apply($,defs).then(function(){window.onbeforeunload=null;},function(failed){self.cancel();self.start();});},_enableEditableArea:function($editable){if($editable.data('oe-type')==="datetime"||$editable.data('oe-type')==="date"){var selector='[data-oe-id="'+$editable.data('oe-id')+'"]';selector+='[data-oe-field="'+$editable.data('oe-field')+'"]';selector+='[data-oe-model="'+$editable.data('oe-model')+'"]';var $linkedFieldNodes=this.editable().find(selector).addBack(selector);$linkedFieldNodes.not($editable).addClass('o_editable_date_field_linked');if(!$editable.hasClass('o_editable_date_field_format_changed')){$linkedFieldNodes.html($editable.data('oe-original-with-format'));$linkedFieldNodes.addClass('o_editable_date_field_format_changed');}}
if($editable.data('oe-type')==="monetary"){$editable.attr('contenteditable',false);$editable.find('.oe_currency_value').attr('contenteditable',true);}
if($editable.is('[data-oe-model]')&&!$editable.is('[data-oe-model="ir.ui.view"]')&&!$editable.is('[data-oe-type="html"]')){$editable.data('layoutInfo').popover().find('.btn-group:not(.note-history)').remove();}},_getDefaultConfig:function($editable){return{'airMode':true,'focus':false,'airPopover':[['style',['style']],['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',['link','picture']],['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':'odoo','onChange':function(html,$editable){$editable.trigger('content_changed');},'colors':summernoteCustomColors,};},_getEscapedElement:function($el){var escaped_el=$el.clone();var to_escape=escaped_el.find('*').addBack();to_escape=to_escape.not(to_escape.filter('object,iframe,script,style,[data-oe-model][data-oe-model!="ir.ui.view"]').find('*').addBack());to_escape.contents().each(function(){if(this.nodeType===3){this.nodeValue=$('<div />').text(this.nodeValue).html();}});return escaped_el;},_saveElement:function($el,context,withLang){return this._rpc({model:'ir.ui.view',method:'save',args:[$el.data('oe-id'),this._getEscapedElement($el).prop('outerHTML'),$el.data('oe-xpath')||null,],context:context,},withLang?undefined:{noContextKeys:'lang',});},_onClick:function(e){e.preventDefault();},_onMousedown:function(ev){var $target=$(ev.target);var $editable=$target.closest('.o_editable');if(this&&this.$last&&this.$last.length&&this.$last[0]!==$target[0]){$('.o_editable_date_field_linked').removeClass('o_editable_date_field_linked');}
if(!$editable.length||$.summernote.core.dom.isContentEditableFalse($target)){return;}
_.defer(function(){$editable.find('[_moz_abspos]').removeAttr('_moz_abspos');});if($target.is('a')){$target.attr('contenteditable',true);_.defer(function(){$editable.not($target).attr('contenteditable',false);$target.focus();});$(document).on('mousedown.reactivate_contenteditable',function(e){if($target.is(e.target))return;$target.removeAttr('contenteditable');$editable.attr('contenteditable',true);$(document).off('mousedown.reactivate_contenteditable');});}
if(this&&this.$last&&(!$editable.length||this.$last[0]!==$editable[0])){var $destroy=this.$last;history.splitNext();_.delay(function(){var id=$destroy.data('note-id');$destroy.destroy().removeData('note-id').removeAttr('data-note-id');$('#note-popover-'+id+', #note-handle-'+id+', #note-dialog-'+id+'').remove();},150);this.$last=null;}
if($editable.length&&(!this.$last||this.$last[0]!==$editable[0])){$editable.summernote(this._getConfig($editable));$editable.data('NoteHistory',history);this.$last=$editable;try{document.execCommand('enableObjectResizing',false,false);document.execCommand('enableInlineTableEditing',false,false);document.execCommand('2D-position',false,false);}catch(e){}
document.body.addEventListener('resizestart',function(evt){evt.preventDefault();return false;});document.body.addEventListener('movestart',function(evt){evt.preventDefault();return false;});document.body.addEventListener('dragstart',function(evt){evt.preventDefault();return false;});if(!range.create()){$editable.focusIn();}
if(dom.isImg($target[0])){$target.trigger('mousedown');}
this._enableEditableArea($editable);}},_onMouseup:function(ev){var $target=$(ev.target);var $editable=$target.closest('.o_editable');if(!$editable.length){return;}
var self=this;_.defer(function(){self.historyRecordUndo($target,'activate',true);});if(ev.originalEvent.detail===3){range.create(ev.target,0,ev.target,ev.target.childNodes.length).select();}},});return{Class:RTEWidget,history:history,};});odoo.define('web_editor.rte.summernote_custom_colors',function(require){'use strict';return[['#000000','#424242','#636363','#9C9C94','#CEC6CE','#EFEFEF','#F7F7F7','#FFFFFF'],['#FF0000','#FF9C00','#FFFF00','#00FF00','#00FFFF','#0000FF','#9C00FF','#FF00FF'],['#F7C6CE','#FFE7CE','#FFEFC6','#D6EFD6','#CEDEE7','#CEE7F7','#D6D6E7','#E7D6DE'],['#E79C9C','#FFC69C','#FFE79C','#B5D6A5','#A5C6CE','#9CC6EF','#B5A5D6','#D6A5BD'],['#E76363','#F7AD6B','#FFD663','#94BD7B','#73A5AD','#6BADDE','#8C7BC6','#C67BA5'],['#CE0000','#E79439','#EFC631','#6BA54A','#4A7B8C','#3984C6','#634AA5','#A54A7B'],['#9C0000','#B56308','#BD9400','#397B21','#104A5A','#085294','#311873','#731842'],['#630000','#7B3900','#846300','#295218','#083139','#003163','#21104A','#4A1031']];});;

/* /web_editor/static/src/js/editor/rte.summernote.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.rte.summernote',function(require){'use strict';var ajax=require('web.ajax');var Class=require('web.Class');var core=require('web.core');var ColorpickerDialog=require('web.colorpicker');var mixins=require('web.mixins');var base=require('web_editor.base');var weContext=require('web_editor.context');var rte=require('web_editor.rte');var ServicesMixin=require('web.ServicesMixin');var weWidgets=require('web_editor.widget');var QWeb=core.qweb;var _t=core._t;ajax.jsonRpc('/web/dataset/call','call',{'model':'ir.ui.view','method':'read_template','args':['web_editor.colorpicker',weContext.get()]}).done(function(data){QWeb.add_template(data);});var dom=$.summernote.core.dom;var range=$.summernote.core.range;var eventHandler=$.summernote.eventHandler;var renderer=$.summernote.renderer;var tplButton=renderer.getTemplate().button;var tplIconButton=renderer.getTemplate().iconButton;var tplDropdown=renderer.getTemplate().dropdown;function _rgbToHex(cssColor){var rgba=cssColor.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);if(!rgba){return cssColor;}
if(rgba[4]){return cssColor;}
var hex=ColorpickerDialog.prototype.convertRgbToHex(parseInt(rgba[1]),parseInt(rgba[2]),parseInt(rgba[3]));if(!hex){return cssColor;}
return hex.hex.toUpperCase();}
var fn_createPalette=renderer.createPalette;renderer.createPalette=function($container,options){fn_createPalette.call(this,$container,options);if(!QWeb.has_template('web_editor.colorpicker')){return;}
var $clpicker=$(QWeb.render('web_editor.colorpicker'));var groups;if($clpicker.is("colorpicker")){groups=_.map($clpicker.find('[data-name="theme"]'),function(el){return $(el).find("button").empty();});}else{groups=[$clpicker.find("button").empty()];}
var html="<h6 class='mt-2'>"+_t("Theme colors")+"</h6>"+_.map(groups,function($group){var $row=$("<div/>",{"class":"note-color-row mb8"}).append($group);var $after_breaks=$row.find(".o_small + :not(.o_small)");if($after_breaks.length===0){$after_breaks=$row.find(":nth-child(8n+9)");}
$after_breaks.addClass("o_clear");return $row[0].outerHTML;}).join("")+"<h6 class='mt-2'>"+_t("Common colors")+"</h6>";var $palettes=$container.find(".note-color .note-color-palette");$palettes.prepend(html);var colors=[];var $editable=window.__EditorMenuBar_$editable||$();_.each($editable.find('[style*="color"]'),function(element){if(element.style.color){colors.push(element.style.color);}
if(element.style.backgroundColor){colors.push(element.style.backgroundColor);}});var $customColorPalettes=$container.find('.note-color .note-custom-color-palette').append($('<div/>',{class:"note-color-row"}));var $customColorRows=$customColorPalettes.find('.note-color-row');_.each(_.uniq(colors),function(color){var hexColor=_rgbToHex(color);if(_.indexOf(_.flatten(options.colors),hexColor)<0){$customColorRows.append('<button type="button" class="o_custom_color" data-color="'+color+'" style="background-color:'+color+';" />');}});$palettes.push.apply($palettes,$customColorPalettes);var $fore=$palettes.filter(":even").find("button:not(.note-color-btn)").addClass("note-color-btn");var $bg=$palettes.filter(":odd").find("button:not(.note-color-btn)").addClass("note-color-btn");$fore.each(function(){var $el=$(this);var className=$el.hasClass('o_custom_color')?$el.data('color'):'text-'+$el.data('color');$el.attr('data-event','foreColor').attr('data-value',className).addClass($el.hasClass('o_custom_color')?'':'bg-'+$el.data('color'));});$bg.each(function(){var $el=$(this);var className=$el.hasClass('o_custom_color')?$el.data('color'):'bg-'+$el.data('color');$el.attr('data-event','backColor').attr('data-value',className).addClass($el.hasClass('o_custom_color')?'':className);});};var fn_tplPopovers=renderer.tplPopovers;renderer.tplPopovers=function(lang,options){var $popover=$(fn_tplPopovers.call(this,lang,options));var $imagePopover=$popover.find('.note-image-popover');var $linkPopover=$popover.find('.note-link-popover');var $airPopover=$popover.find('.note-air-popover');$(tplIconButton('fa fa-align-center',{title:_t('Center'),event:'floatMe',value:'center'})).insertAfter($imagePopover.find('[data-event="floatMe"][data-value="left"]'));$imagePopover.find('button[data-event="removeMedia"]').parent().remove();$imagePopover.find('button[data-event="floatMe"][data-value="none"]').remove();var $padding=$('<div class="btn-group"/>');$padding.insertBefore($imagePopover.find('.btn-group:first'));var dropdown_content=['<li><a class="dropdown-item" data-event="padding" href="#" data-value="">'+_t('None')+'</a></li>','<li><a class="dropdown-item" data-event="padding" href="#" data-value="small">'+_t('Small')+'</a></li>','<li><a class="dropdown-item" data-event="padding" href="#" data-value="medium">'+_t('Medium')+'</a></li>','<li><a class="dropdown-item" data-event="padding" href="#" data-value="large">'+_t('Large')+'</a></li>','<li><a class="dropdown-item" data-event="padding" href="#" data-value="xl">'+_t('Xl')+'</a></li>',];$(tplIconButton('fa fa-plus-square-o',{title:_t('Padding'),dropdown:tplDropdown(dropdown_content)})).appendTo($padding);$imagePopover.find('[data-event="imageShape"]:not([data-value])').remove();var $button=$(tplIconButton('fa fa-sun-o',{title:_t('Shadow'),event:'imageShape',value:'shadow'})).insertAfter($imagePopover.find('[data-event="imageShape"][data-value="rounded-circle"]'));var $spin=$('<div class="btn-group d-none only_fa"/>').insertAfter($button.parent());$(tplIconButton('fa fa-refresh',{title:_t('Spin'),event:'imageShape',value:'fa-spin'})).appendTo($spin);var $resizefa=$('<div class="btn-group d-none only_fa"/>').insertAfter($imagePopover.find('.btn-group:has([data-event="resize"])'));for(var size=1;size<=5;size++){$(tplButton('<span class="note-fontsize-10">'+size+'x</span>',{title:size+"x",event:'resizefa',value:size+''})).appendTo($resizefa);}
var $colorfa=$airPopover.find('.note-color').clone();$colorfa.find(".dropdown-menu").css('min-width','172px');$resizefa.after($colorfa);var $imageprop=$('<div class="btn-group"/>');$imageprop.appendTo($imagePopover.find('.popover-body'));$(tplIconButton('fa fa-file-image-o',{title:_t('Edit'),event:'showImageDialog'})).appendTo($imageprop);$(tplIconButton('fa fa-trash-o',{title:_t('Remove'),event:'delete'})).appendTo($imageprop);$(tplIconButton('fa fa-crop',{title:_t('Crop Image'),event:'cropImage',})).insertAfter($imagePopover.find('[data-event="imageShape"][data-value="img-thumbnail"]'));$imagePopover.find('.popover-body').append($airPopover.find(".note-history").clone());$imagePopover.find('[data-event="showImageDialog"]').before($airPopover.find('[data-event="showLinkDialog"]').clone());var $alt=$('<div class="btn-group"/>');$alt.appendTo($imagePopover.find('.popover-body'));$alt.append('<button class="btn btn-secondary" data-event="alt"><strong>'+_t('Description')+': </strong><span class="o_image_alt"/></button>');$linkPopover.find('.popover-body').append($airPopover.find(".note-history").clone());$linkPopover.find('button[data-event="showLinkDialog"] i').attr("class","fa fa-link");$linkPopover.find('button[data-event="unlink"]').before($airPopover.find('button[data-event="showImageDialog"]').clone());$airPopover.find('.note-style .dropdown-toggle').on('mousedown',function(){var $format=$airPopover.find('[data-event="formatBlock"]');var node=range.create().sc;var formats=$format.map(function(){return $(this).data("value");}).get();while(node&&(!node.tagName||(!node.tagName||formats.indexOf(node.tagName.toLowerCase())===-1))){node=node.parentNode;}
$format.removeClass('active');$format.filter('[data-value="'+(node?node.tagName.toLowerCase():"p")+'"]').addClass("active");});setTimeout(function(){$airPopover.add($linkPopover).add($imagePopover).find("button").tooltip('dispose').tooltip({container:'body',trigger:'hover',placement:'bottom'}).on('click',function(){$(this).tooltip('hide');});});return $popover;};var fn_boutton_update=eventHandler.modules.popover.button.update;eventHandler.modules.popover.button.update=function($container,oStyle){var previous=$(".note-control-selection").data('target');if(previous){var $previous=$(previous);$previous.css({"-webkit-animation-play-state":"","animation-play-state":"","-webkit-transition":"","transition":"","-webkit-animation":"","animation":""});$previous.find('.o_we_selected_image').addBack('.o_we_selected_image').removeClass('o_we_selected_image');}
fn_boutton_update.call(this,$container,oStyle);$container.find('.note-color').removeClass('d-none');if(oStyle.image){$container.find('[data-event]').removeClass("active");$container.find('a[data-event="padding"][data-value="small"]').toggleClass("active",$(oStyle.image).hasClass("padding-small"));$container.find('a[data-event="padding"][data-value="medium"]').toggleClass("active",$(oStyle.image).hasClass("padding-medium"));$container.find('a[data-event="padding"][data-value="large"]').toggleClass("active",$(oStyle.image).hasClass("padding-large"));$container.find('a[data-event="padding"][data-value="xl"]').toggleClass("active",$(oStyle.image).hasClass("padding-xl"));$container.find('a[data-event="padding"][data-value=""]').toggleClass("active",!$container.find('li a.active[data-event="padding"]').length);$(oStyle.image).addClass('o_we_selected_image');if(dom.isImgFont(oStyle.image)){$container.find('[data-event="customColor"][data-value="foreColor"]').attr('data-color',$(oStyle.image).css('color'));$container.find('[data-event="customColor"][data-value="backColor"]').attr('data-color',$(oStyle.image).css('background-color'));$container.find('.note-fore-color-preview > button').css('border-bottom-color',$(oStyle.image).css('color'));$container.find('.note-back-color-preview > button').css('border-bottom-color',$(oStyle.image).css('background-color'));$container.find('.btn-group:not(.only_fa):has(button[data-event="resize"],button[data-value="img-thumbnail"])').addClass('d-none');$container.find('.only_fa').removeClass('d-none');$container.find('button[data-event="resizefa"][data-value="2"]').toggleClass("active",$(oStyle.image).hasClass("fa-2x"));$container.find('button[data-event="resizefa"][data-value="3"]').toggleClass("active",$(oStyle.image).hasClass("fa-3x"));$container.find('button[data-event="resizefa"][data-value="4"]').toggleClass("active",$(oStyle.image).hasClass("fa-4x"));$container.find('button[data-event="resizefa"][data-value="5"]').toggleClass("active",$(oStyle.image).hasClass("fa-5x"));$container.find('button[data-event="resizefa"][data-value="1"]').toggleClass("active",!$container.find('.active[data-event="resizefa"]').length);$container.find('button[data-event="cropImage"]').addClass('d-none');$container.find('button[data-event="imageShape"][data-value="fa-spin"]').toggleClass("active",$(oStyle.image).hasClass("fa-spin"));$container.find('button[data-event="imageShape"][data-value="shadow"]').toggleClass("active",$(oStyle.image).hasClass("shadow"));$container.find('.btn-group:has(button[data-event="imageShape"])').removeClass("d-none");}else{$container.find('.d-none:not(.only_fa, .note-recent-color)').removeClass('d-none');$container.find('button[data-event="cropImage"]').removeClass('d-none');$container.find('.only_fa').addClass('d-none');var width=($(oStyle.image).attr('style')||'').match(/(^|;|\s)width:\s*([0-9]+%)/);if(width){width=width[2];}
$container.find('button[data-event="resize"][data-value="auto"]').toggleClass("active",width!=="100%"&&width!=="50%"&&width!=="25%");$container.find('button[data-event="resize"][data-value="1"]').toggleClass("active",width==="100%");$container.find('button[data-event="resize"][data-value="0.5"]').toggleClass("active",width==="50%");$container.find('button[data-event="resize"][data-value="0.25"]').toggleClass("active",width==="25%");$container.find('button[data-event="imageShape"][data-value="shadow"]').toggleClass("active",$(oStyle.image).hasClass("shadow"));if(!$(oStyle.image).is("img")){$container.find('.btn-group:has(button[data-event="imageShape"])').addClass('d-none');}
$container.find('.note-color').addClass('d-none');}
$container.find('button[data-event="floatMe"][data-value="left"]').toggleClass("active",$(oStyle.image).hasClass("float-left"));$container.find('button[data-event="floatMe"][data-value="center"]').toggleClass("active",$(oStyle.image).hasClass("d-block mx-auto"));$container.find('button[data-event="floatMe"][data-value="right"]').toggleClass("active",$(oStyle.image).hasClass("float-right"));$(oStyle.image).trigger('attributes_change');}else{$container.find('[data-event="customColor"][data-value="foreColor"]').attr('data-color',oStyle.color);$container.find('[data-event="customColor"][data-value="backColor"]').attr('data-color',oStyle['background-color']);$container.find('.note-fore-color-preview > button').css('border-bottom-color',oStyle.color);$container.find('.note-back-color-preview > button').css('border-bottom-color',oStyle['background-color']);}};var fn_popover_update=eventHandler.modules.popover.update;eventHandler.modules.popover.update=function($popover,oStyle,isAirMode){var $imagePopover=$popover.find('.note-image-popover');var $linkPopover=$popover.find('.note-link-popover');var $airPopover=$popover.find('.note-air-popover');fn_popover_update.call(this,$popover,oStyle,isAirMode);if(oStyle.image){if(oStyle.image.parentNode.className.match(/(^|\s)media_iframe_video(\s|$)/i)){oStyle.image=oStyle.image.parentNode;}
var alt=$(oStyle.image).attr("alt");$imagePopover.find('.o_image_alt').text((alt||"").replace(/&quot;/g,'"')).parent().toggle(oStyle.image.tagName==="IMG");$imagePopover.show();var target_node=oStyle.image;if(!oStyle.image.className.match(/(^|\s)media_iframe_video(\s|$)/i)){target_node=dom.firstChild(target_node);}
range.createFromNode(target_node).select();eventHandler.modules.editor.saveRange(dom.makeLayoutInfo(target_node).editable());}else{$(".note-control-selection").hide();}
if(oStyle.image||(oStyle.range&&(!oStyle.range.isCollapsed()||(oStyle.range.sc.tagName&&!dom.isAnchor(oStyle.range.sc))))||(oStyle.image&&!$(oStyle.image).closest('a').length)){$linkPopover.hide();oStyle.anchor=false;}
if(oStyle.image||oStyle.anchor||(oStyle.range&&!$(oStyle.range.sc).closest('.note-editable').length)){$airPopover.hide();}else{$airPopover.show();}};var fn_handle_update=eventHandler.modules.handle.update;eventHandler.modules.handle.update=function($handle,oStyle,isAirMode){fn_handle_update.call(this,$handle,oStyle,isAirMode);if(oStyle.image){$handle.find('.note-control-selection').hide();}};function getImgTarget($editable){var $handle=$editable?dom.makeLayoutInfo($editable).handle():undefined;return $(".note-control-selection",$handle).data('target');}
eventHandler.modules.editor.padding=function($editable,sValue){var $target=$(getImgTarget($editable));var paddings="small medium large xl".split(/\s+/);$editable.data('NoteHistory').recordUndo();if(sValue.length){paddings.splice(paddings.indexOf(sValue),1);$target.toggleClass('padding-'+sValue);}
$target.removeClass("padding-"+paddings.join(" padding-"));};eventHandler.modules.editor.resize=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();var width=($target.attr('style')||'').match(/(^|;|\s)width:\s*([0-9]+)%/);if(width){width=width[2]/100;}
$target.css('width',(width!==sValue&&sValue!=="auto")?(sValue*100)+'%':'');};eventHandler.modules.editor.resizefa=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();$target.attr('class',$target.attr('class').replace(/\s*fa-[0-9]+x/g,''));if(+sValue>1){$target.addClass('fa-'+sValue+'x');}};eventHandler.modules.editor.floatMe=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();switch(sValue){case'center':$target.toggleClass('d-block mx-auto').removeClass('float-right float-left');break;case'left':$target.toggleClass('float-left').removeClass('float-right d-block mx-auto');break;case'right':$target.toggleClass('float-right').removeClass('float-left d-block mx-auto');break;}};eventHandler.modules.editor.imageShape=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();$target.toggleClass(sValue);};eventHandler.modules.linkDialog.showLinkDialog=function($editable,$dialog,linkInfo){$editable.data('range').select();$editable.data('NoteHistory').recordUndo();var def=new $.Deferred();core.bus.trigger('link_dialog_demand',{$editable:$editable,linkInfo:linkInfo,onSave:function(linkInfo){linkInfo.range.select();$editable.data('range',linkInfo.range);def.resolve(linkInfo);$editable.trigger('keyup');$('.note-popover .note-link-popover').show();},onCancel:def.reject.bind(def),});return def;};eventHandler.modules.imageDialog.showImageDialog=function($editable){var r=$editable.data('range');if(r.sc.tagName&&r.sc.childNodes.length){r.sc=r.sc.childNodes[r.so];}
var media=$(r.sc).parents().addBack().filter(function(i,el){return dom.isImg(el);})[0];core.bus.trigger('media_dialog_demand',{$editable:$editable,media:media,options:{onUpload:$editable.data('callbacks').onUpload,noVideos:$editable.data('oe-model')==="mail.compose.message"||$editable.data('oe-model')==="mail.mass_mailing",},});return new $.Deferred().reject();};$.summernote.pluginEvents.alt=function(event,editor,layoutInfo,sorted){var $editable=layoutInfo.editable();var $selection=layoutInfo.handle().find('.note-control-selection');core.bus.trigger('alt_dialog_demand',{$editable:$editable,media:$selection.data('target'),});};$.summernote.pluginEvents.customColor=function(event,editor,layoutInfo,customColor){var defaultColor=event.target.dataset.color;core.bus.trigger('color_picker_dialog_demand',{color:defaultColor==='rgba(0, 0, 0, 0)'?'rgb(255, 0, 0)':defaultColor,onSave:function(color){var $palettes=$(event.currentTarget).find('.note-custom-color-palette > .note-color-row').append(('<button type="button" class="note-color-btn" data-value="'+color+'" style="background-color:'+color+';" />'));$palettes.filter(':odd').find('button:not([data-event])').attr('data-event','backColor');$palettes.filter(':even').find('button:not([data-event])').attr('data-event','foreColor');if(customColor==='foreColor'){$(event.currentTarget).find('.note-fore-color-preview > button').css('border-bottom-color',color);$.summernote.pluginEvents.foreColor(event,editor,layoutInfo,color);}else{$(event.currentTarget).find('.note-back-color-preview > button').css('border-bottom-color',color);$.summernote.pluginEvents.backColor(event,editor,layoutInfo,color);}}});};$.summernote.pluginEvents.cropImage=function(event,editor,layoutInfo,sorted){var $editable=layoutInfo.editable();var $selection=layoutInfo.handle().find('.note-control-selection');core.bus.trigger('crop_image_dialog_demand',{$editable:$editable,media:$selection.data('target'),});};var fn_is_void=dom.isVoid||function(){};dom.isVoid=function(node){return fn_is_void(node)||dom.isImgFont(node)||(node&&node.className&&node.className.match(/(^|\s)media_iframe_video(\s|$)/i));};var fn_is_img=dom.isImg||function(){};dom.isImg=function(node){return fn_is_img(node)||dom.isImgFont(node)||(node&&(node.nodeName==="IMG"||(node.className&&node.className.match(/(^|\s)(media_iframe_video|o_image)(\s|$)/i))));};var fn_is_forbidden_node=dom.isForbiddenNode||function(){};dom.isForbiddenNode=function(node){if(node.tagName==="BR"){return false;}
return fn_is_forbidden_node(node)||$(node).is(".media_iframe_video");};var fn_is_img_font=dom.isImgFont||function(){};dom.isImgFont=function(node){if(fn_is_img_font(node))return true;var nodeName=node&&node.nodeName.toUpperCase();var className=(node&&node.className||"");if(node&&(nodeName==="SPAN"||nodeName==="I")&&className.length){var classNames=className.split(/\s+/);for(var k=0;k<base.fontIcons.length;k++){if(_.intersection(base.fontIcons[k].alias,classNames).length){return true;}}}
return false;};var fn_is_font=dom.isFont;dom.isFont=function(node){return fn_is_font(node)||dom.isImgFont(node);};var fn_visible=$.summernote.pluginEvents.visible;$.summernote.pluginEvents.visible=function(event,editor,layoutInfo){var res=fn_visible.apply(this,arguments);var rng=range.create();if(!rng)return res;var $node=$(dom.node(rng.sc));if(($node.is('[data-oe-type="html"]')||$node.is('[data-oe-field="arch"]'))&&$node.hasClass("o_editable")&&!$node[0].children.length&&"h1 h2 h3 h4 h5 h6 p b bold i u code sup strong small pre th td span label".toUpperCase().indexOf($node[0].nodeName)===-1){var p=$('<p><br/></p>')[0];$node.append(p);range.createFromNode(p.firstChild).select();}
return res;};function prettify_html(html){html=html.trim();var result='',level=0,get_space=function(level){var i=level,space='';while(i--)space+='  ';return space;},reg=/^<\/?(a|span|font|u|em|i|strong|b)(\s|>)/i,inline_level=Infinity,tokens=_.compact(_.flatten(_.map(html.split(/</),function(value){value=value.replace(/\s+/g,' ').split(/>/);value[0]=/\S/.test(value[0])?'<'+value[0]+'>':'';return value;})));for(var i=0,l=tokens.length;i<l;i++){var token=tokens[i];var inline_tag=reg.test(token);var inline=inline_tag||inline_level<=level;if(token[0]==='<'&&token[1]==='/'){if(inline_tag&&inline_level===level){inline_level=Infinity;}
level--;}
if(!inline&&!/\S/.test(token)){continue;}
if(!inline||(token[1]!=='/'&&inline_level>level)){result+=get_space(level);}
if(token[0]==='<'&&token[1]!=='/'){level++;if(inline_tag&&inline_level>level){inline_level=level;}}
if(token.match(/^<(img|hr|br)/)){level--;}
if(!inline){token=token.trim();}
result+=token.replace(/\s+/,' ');if(inline_level>level){result+='\n';}}
return result;}
$.summernote.pluginEvents.codeview=function(event,editor,layoutInfo,enable){if(layoutInfo===undefined){return;}
if(layoutInfo.toolbar){var is_activated=$.summernote.eventHandler.modules.codeview.isActivated(layoutInfo);if(is_activated===enable){return;}
return eventHandler.modules.codeview.toggle(layoutInfo);}else{var $editor=layoutInfo.editor();var $textarea=$editor.prev('textarea');if($textarea.is('textarea')===enable){return;}
if(!$textarea.length){var html=prettify_html($editor.prop("innerHTML"));$editor.parent().css({'position':'absolute','top':0,'bottom':0,'left':0,'right':0});$textarea=$('<textarea/>').css({'margin':'0 -4px','padding':'0 4px','border':0,'top':'51px','left':'620px','width':'100%','font-family':'sans-serif','font-size':'13px','height':'98%','white-space':'pre','word-wrap':'normal'}).val(html).data('init',html);$editor.before($textarea);$editor.hide();}else{$editor.prop('innerHTML',$textarea.val().replace(/\s*\n\s*/g,'')).trigger('content_changed');$textarea.remove();$editor.show();}}};var last_div;var last_div_change;var last_editable;var initial_data={};function reRangeSelectKey(event){initial_data.range=null;if(event.shiftKey&&event.keyCode>=37&&event.keyCode<=40&&!$(event.target).is("input, textarea, select")){var r=range.create();if(r){var rng=r.reRange(event.keyCode<=38);if(r!==rng){rng.select();}}}}
function reRangeSelect(event,dx,dy){var r=range.create();if(!r||r.isCollapsed())return;var data=r.reRange(dy<0||(dy===0&&dx<0));if(data.sc!==r.sc||data.so!==r.so||data.ec!==r.ec||data.eo!==r.eo){setTimeout(function(){data.select();$(data.sc.parentNode).closest('.note-popover');},0);}
$(data.sc).closest('.o_editable').data('range',r);return r;}
function summernote_mouseup(event){if($(event.target).closest("#web_editor-top-navbar, .note-popover").length){return;}
if(initial_data.event){var dx=event.clientX-(event.shiftKey&&initial_data.rect?initial_data.rect.left:initial_data.event.clientX);var dy=event.clientY-(event.shiftKey&&initial_data.rect?initial_data.rect.top:initial_data.event.clientY);if(10<Math.pow(dx,2)+Math.pow(dy,2)){reRangeSelect(event,dx,dy);}}
if(!$(event.target).closest(".o_editable").length){return;}
if(!initial_data.range||!event.shiftKey){setTimeout(function(){initial_data.range=range.create();},0);}}
var remember_selection;function summernote_mousedown(event){rte.history.splitNext();var $editable=$(event.target).closest(".o_editable, .note-editor");var r;if(document.documentMode){summernote_ie_fix(event,function(node){return node.tagName==="DIV"||node.tagName==="IMG"||(node.dataset&&node.dataset.oeModel);});}else if(last_div&&event.target!==last_div){if(last_div.tagName==="A"){summernote_ie_fix(event,function(node){return node.dataset&&node.dataset.oeModel;});}else if($editable.length){if(summernote_ie_fix(event,function(node){return node.tagName==="A";})){r=range.create();r.select();}}}
try{r=range.create();}catch(e){return;}
var editables=$(".o_editable[contenteditable], .note-editable[contenteditable]");var r_editable=editables.has((r||{}).sc).addBack(editables.filter((r||{}).sc));if(!r_editable.closest('.note-editor').is($editable)&&!r_editable.filter('.o_editable').is(editables)){var saved_editable=editables.has((remember_selection||{}).sc);if($editable.length&&!saved_editable.closest('.o_editable, .note-editor').is($editable)){remember_selection=range.create(dom.firstChild($editable[0]),0);}else if(!saved_editable.length){remember_selection=undefined;}
if(remember_selection){try{remember_selection.select();}catch(e){console.warn(e);}}}else if(r_editable.length){remember_selection=r;}
initial_data.event=event;if(event.shiftKey&&$editable.length){if(initial_data.range){initial_data.range.select();}
var rect=r&&r.getClientRects();initial_data.rect=rect&&rect.length?rect[0]:{top:0,left:0};}}
function summernote_ie_fix(event,pred){var editable;var div;var node=event.target;while(node.parentNode){if(!div&&pred(node)){div=node;}
if(last_div!==node&&(node.getAttribute('contentEditable')==='false'||node.className&&(node.className.indexOf('o_not_editable')!==-1))){break;}
if(node.className&&node.className.indexOf('o_editable')!==-1){if(!div){div=node;}
editable=node;break;}
node=node.parentNode;}
if(!editable){$(last_div_change).removeAttr("contentEditable").removeProp("contentEditable");$(last_editable).attr("contentEditable","true").prop("contentEditable","true");last_div_change=null;last_editable=null;return;}
if(div===last_div){return;}
last_div=div;$(last_div_change).removeAttr("contentEditable").removeProp("contentEditable");if(last_editable!==editable){if($(editable).is("[contentEditable='true']")){$(editable).removeAttr("contentEditable").removeProp("contentEditable");last_editable=editable;}else{last_editable=null;}}
if(!$(div).attr("contentEditable")&&!$(div).is("[data-oe-type='many2one'], [data-oe-type='contact']")){$(div).attr("contentEditable","true").prop("contentEditable","true");last_div_change=div;}else{last_div_change=null;}
return editable!==div?div:null;}
var fn_attach=eventHandler.attach;eventHandler.attach=function(oLayoutInfo,options){fn_attach.call(this,oLayoutInfo,options);oLayoutInfo.editor().on('dragstart','img',function(e){e.preventDefault();});$(document).on('mousedown',summernote_mousedown).on('mouseup',summernote_mouseup);oLayoutInfo.editor().off('click').on('click',function(e){e.preventDefault();});create_dblclick_feature("img, .media_iframe_video, i.fa, span.fa, a.o_image",function(){eventHandler.modules.imageDialog.show(oLayoutInfo);});create_dblclick_feature("a[href], a.btn, button.btn",function(){eventHandler.modules.linkDialog.show(oLayoutInfo);});oLayoutInfo.editable().on('mousedown',function(e){if(dom.isImg(e.target)&&dom.isContentEditable(e.target)){range.createFromNode(e.target).select();}});$(document).on("keyup",reRangeSelectKey);var clone_data=false;if(options.model){oLayoutInfo.editable().data({'oe-model':options.model,'oe-id':options.id});}
if(options.getMediaDomain){oLayoutInfo.editable().data('oe-media-domain',options.getMediaDomain);}
var $node=oLayoutInfo.editor();if($node.data('oe-model')||$node.data('oe-translation-id')){$node.on('content_changed',function(){var $nodes=$('[data-oe-model], [data-oe-translation-id]').filter(function(){return this!==$node[0];});if($node.data('oe-model')){$nodes=$nodes.filter('[data-oe-model="'+$node.data('oe-model')+'"]').filter('[data-oe-id="'+$node.data('oe-id')+'"]').filter('[data-oe-field="'+$node.data('oe-field')+'"]');}
if($node.data('oe-translation-id'))$nodes=$nodes.filter('[data-oe-translation-id="'+$node.data('oe-translation-id')+'"]');if($node.data('oe-type'))$nodes=$nodes.filter('[data-oe-type="'+$node.data('oe-type')+'"]');if($node.data('oe-expression'))$nodes=$nodes.filter('[data-oe-expression="'+$node.data('oe-expression')+'"]');if($node.data('oe-xpath'))$nodes=$nodes.filter('[data-oe-xpath="'+$node.data('oe-xpath')+'"]');if($node.data('oe-contact-options'))$nodes=$nodes.filter('[data-oe-contact-options="'+$node.data('oe-contact-options')+'"]');var nodes=$node.get();if($node.data('oe-type')==="many2one"){$nodes=$nodes.add($('[data-oe-model]').filter(function(){return this!==$node[0]&&nodes.indexOf(this)===-1;}).filter('[data-oe-many2one-model="'+$node.data('oe-many2one-model')+'"]').filter('[data-oe-many2one-id="'+$node.data('oe-many2one-id')+'"]').filter('[data-oe-type="many2one"]'));$nodes=$nodes.add($('[data-oe-model]').filter(function(){return this!==$node[0]&&nodes.indexOf(this)===-1;}).filter('[data-oe-model="'+$node.data('oe-many2one-model')+'"]').filter('[data-oe-id="'+$node.data('oe-many2one-id')+'"]').filter('[data-oe-field="name"]'));}
if(!clone_data){clone_data=true;$nodes.html(this.innerHTML);clone_data=false;}});}
var custom_toolbar=oLayoutInfo.toolbar?oLayoutInfo.toolbar():undefined;var $toolbar=$(oLayoutInfo.popover()).add(custom_toolbar);$('button[data-event="undo"], button[data-event="redo"]',$toolbar).attr('disabled',true);$(oLayoutInfo.editor()).add(oLayoutInfo.handle()).add(oLayoutInfo.popover()).add(custom_toolbar).on('click content_changed',function(){$('button[data-event="undo"]',$toolbar).attr('disabled',!oLayoutInfo.editable().data('NoteHistory').hasUndo());$('button[data-event="redo"]',$toolbar).attr('disabled',!oLayoutInfo.editable().data('NoteHistory').hasRedo());});function create_dblclick_feature(selector,callback){var show_tooltip=true;oLayoutInfo.editor().on("dblclick",selector,function(e){var $target=$(e.target);if(!dom.isContentEditable($target)){return;}
show_tooltip=false;callback();e.stopImmediatePropagation();});oLayoutInfo.editor().on("click",selector,function(e){var $target=$(e.target);if(!dom.isContentEditable($target)){return;}
show_tooltip=true;setTimeout(function(){if(!show_tooltip||$target.attr('title')!==undefined){return;}
$target.tooltip({title:_t('Double-click to edit'),trigger:'manuel',container:'body'}).tooltip('show');setTimeout(function(){$target.tooltip('dispose');},800);},400);});}};var fn_detach=eventHandler.detach;eventHandler.detach=function(oLayoutInfo,options){fn_detach.call(this,oLayoutInfo,options);oLayoutInfo.editable().off('mousedown');oLayoutInfo.editor().off("dragstart");oLayoutInfo.editor().off('click');$(document).off('mousedown',summernote_mousedown);$(document).off('mouseup',summernote_mouseup);oLayoutInfo.editor().off("dblclick");$(document).off("keyup",reRangeSelectKey);};$.summernote.lang.odoo={font:{bold:_t('Bold'),italic:_t('Italic'),underline:_t('Underline'),strikethrough:_t('Strikethrough'),subscript:_t('Subscript'),superscript:_t('Superscript'),clear:_t('Remove Font Style'),height:_t('Line Height'),name:_t('Font Family'),size:_t('Font Size')},image:{image:_t('File / Image'),insert:_t('Insert Image'),resizeFull:_t('Resize Full'),resizeHalf:_t('Resize Half'),resizeQuarter:_t('Resize Quarter'),floatLeft:_t('Float Left'),floatRight:_t('Float Right'),floatNone:_t('Float None'),dragImageHere:_t('Drag an image here'),selectFromFiles:_t('Select from files'),url:_t('Image URL'),remove:_t('Remove Image')},link:{link:_t('Link'),insert:_t('Insert Link'),unlink:_t('Unlink'),edit:_t('Edit'),textToDisplay:_t('Text to display'),url:_t('To what URL should this link go?'),openInNewWindow:_t('Open in new window')},video:{video:_t('Video'),videoLink:_t('Video Link'),insert:_t('Insert Video'),url:_t('Video URL?'),providers:_t('(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)')},table:{table:_t('Table')},hr:{insert:_t('Insert Horizontal Rule')},style:{style:_t('Style'),normal:_t('Normal'),blockquote:_t('Quote'),pre:_t('Code'),small:_t('Small'),h1:_t('Header 1'),h2:_t('Header 2'),h3:_t('Header 3'),h4:_t('Header 4'),h5:_t('Header 5'),h6:_t('Header 6')},lists:{unordered:_t('Unordered list'),ordered:_t('Ordered list')},options:{help:_t('Help'),fullscreen:_t('Full Screen'),codeview:_t('Code View')},paragraph:{paragraph:_t('Paragraph'),outdent:_t('Outdent'),indent:_t('Indent'),left:_t('Align left'),center:_t('Align center'),right:_t('Align right'),justify:_t('Justify full')},color:{custom:_t('Custom Color'),background:_t('Background Color'),foreground:_t('Font Color'),transparent:_t('Transparent'),setTransparent:_t('None'),},shortcut:{shortcuts:_t('Keyboard shortcuts'),close:_t('Close'),textFormatting:_t('Text formatting'),action:_t('Action'),paragraphFormatting:_t('Paragraph formatting'),documentStyle:_t('Document Style')},history:{undo:_t('Undo'),redo:_t('Redo')}};var SummernoteManager=Class.extend(mixins.EventDispatcherMixin,ServicesMixin,{init:function(parent){mixins.EventDispatcherMixin.init.call(this);this.setParent(parent);core.bus.on('alt_dialog_demand',this,this._onAltDialogDemand);core.bus.on('color_picker_dialog_demand',this,this._onColorPickerDialogDemand);core.bus.on('crop_image_dialog_demand',this,this._onCropImageDialogDemand);core.bus.on('link_dialog_demand',this,this._onLinkDialogDemand);core.bus.on('media_dialog_demand',this,this._onMediaDialogDemand);},destroy:function(){mixins.EventDispatcherMixin.destroy.call(this);core.bus.off('alt_dialog_demand',this,this._onAltDialogDemand);core.bus.off('color_picker_dialog_demand',this,this._onColorPickerDialogDemand);core.bus.off('crop_image_dialog_demand',this,this._onCropImageDialogDemand);core.bus.off('link_dialog_demand',this,this._onLinkDialogDemand);core.bus.off('media_dialog_demand',this,this._onMediaDialogDemand);},saveCroppedImages:function($editable){var self=this;var defs=_.map($editable.find('.o_cropped_img_to_save'),function(croppedImg){var $croppedImg=$(croppedImg);$croppedImg.removeClass('o_cropped_img_to_save');var resModel=$croppedImg.data('crop:resModel');var resID=$croppedImg.data('crop:resID');var cropID=$croppedImg.data('crop:id');var mimetype=$croppedImg.data('crop:mimetype');var originalSrc=$croppedImg.data('crop:originalSrc');var datas=$croppedImg.attr('src').split(',')[1];var def;if(!cropID){var name=originalSrc+'.crop';def=self._rpc({model:'ir.attachment',method:'create',args:[{res_model:resModel,res_id:resID,name:name,datas_fname:name,datas:datas,mimetype:mimetype,url:originalSrc,}],});}else{def=self._rpc({model:'ir.attachment',method:'write',args:[[cropID],{datas:datas}],}).then(function(){return cropID;});}
return def.then(function(attachmentID){return self._rpc({model:'ir.attachment',method:'generate_access_token',args:[[attachmentID]],}).then(function(access_token){$croppedImg.attr('src','/web/image/'+attachmentID+'?access_token='+access_token[0]);});});});return $.when.apply($,defs);},_onAltDialogDemand:function(data){if(data.__alreadyDone){return;}
data.__alreadyDone=true;var altDialog=new weWidgets.AltDialog(this,data.options||{},data.$editable,data.media);if(data.onSave){altDialog.on('save',this,data.onSave);}
if(data.onCancel){altDialog.on('cancel',this,data.onCancel);}
altDialog.open();},_onColorPickerDialogDemand:function(data){if(data.__alreadyDone){return;}
data.__alreadyDone=true;var colorpicker=new ColorpickerDialog(this,{defaultColor:data.color,});if(data.onSave){colorpicker.on('colorpicker:saved',this,function(ev){data.onSave(ev.data.cssColor);});}
colorpicker.open();},_onCropImageDialogDemand:function(data){if(data.__alreadyDone){return;}
data.__alreadyDone=true;var cropImageDialog=new weWidgets.CropImageDialog(this,_.extend({res_model:data.$editable.data('oe-model'),res_id:data.$editable.data('oe-id'),},data.options||{}),data.$editable,data.media);if(data.onSave){cropImageDialog.on('save',this,data.onSave);}
if(data.onCancel){cropImageDialog.on('cancel',this,data.onCancel);}
cropImageDialog.open();},_onLinkDialogDemand:function(data){if(data.__alreadyDone){return;}
data.__alreadyDone=true;var linkDialog=new weWidgets.LinkDialog(this,data.options||{},data.$editable,data.linkInfo);if(data.onSave){linkDialog.on('save',this,data.onSave);}
if(data.onCancel){linkDialog.on('cancel',this,data.onCancel);}
linkDialog.open();},_onMediaDialogDemand:function(data){if(data.__alreadyDone){return;}
data.__alreadyDone=true;var mediaDialog=new weWidgets.MediaDialog(this,_.extend({res_model:data.$editable.data('oe-model'),res_id:data.$editable.data('oe-id'),domain:data.$editable.data('oe-media-domain'),},data.options),data.$editable,data.media);if(data.onSave){mediaDialog.on('save',this,data.onSave);}
if(data.onCancel){mediaDialog.on('cancel',this,data.onCancel);}
mediaDialog.open();},});rte.Class.include({start:function(){this._summernoteManager=new SummernoteManager(this);return this._super.apply(this,arguments);},cancel:function(){this._super.apply(this,arguments);this._summernoteManager.destroy();},saveCroppedImages:function($editable){return this._summernoteManager.saveCroppedImages($editable);},});return SummernoteManager;});;

/* /web_editor/static/src/js/editor/snippets.editor.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.snippet.editor',function(require){'use strict';var core=require('web.core');var dom=require('web.dom');var Widget=require('web.Widget');var options=require('web_editor.snippets.options');var _t=core._t;var globalSelector={closest:function(){return $();},all:function(){return $();},is:function(){return false;},};var SnippetEditor=Widget.extend({template:'web_editor.snippet_overlay',xmlDependencies:['/web_editor/static/src/xml/snippets.xml'],events:{'click .oe_snippet_parent':'_onParentButtonClick','click .oe_snippet_clone':'_onCloneClick','click .oe_snippet_remove':'_onRemoveClick',},custom_events:{cover_update:'_onCoverUpdate',option_update:'_onOptionUpdate',},init:function(parent,target,templateOptions){this._super.apply(this,arguments);this.$target=$(target);this.$target.data('snippet-editor',this);this.templateOptions=templateOptions;this.__isStarted=$.Deferred();},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];var $parent=globalSelector.closest(this.$target.parent());if(!$parent.length){this.$('.oe_snippet_parent').remove();}
defs.push(this._initializeOptions());if(!this.$target.parent().is(':o_editable')){this.$el.find('.oe_snippet_move, .oe_snippet_clone, .oe_snippet_remove').remove();}else{this.dropped=false;this.$el.draggable({greedy:true,appendTo:'body',cursor:'move',handle:'.oe_snippet_move',cursorAt:{left:18,top:14},helper:function(){var $clone=$(this).clone().css({width:'24px',height:'24px',border:0});$clone.find('.oe_overlay_options >:not(:contains(.oe_snippet_move)), .o_handle').remove();$clone.find(':not(.glyphicon)').css({position:'absolute',top:0,left:0});$clone.appendTo('body').removeClass('d-none');return $clone;},start:_.bind(self._onDragAndDropStart,self),stop:function(){var args=arguments;setTimeout(function(){self._onDragAndDropStop.apply(self,args);},0);},});}
this.$target.on('transitionstart.snippet_editor, animationstart.snippet_editor',function(){self._targetIsAnimated=true;});this.$target.on('transitionend.snippet_editor, animationend.snippet_editor',function(){self._targetIsAnimated=false;if(self.$el.is('.oe_active')){self.cover();}});return $.when.apply($,defs).then(function(){self.__isStarted.resolve(self);});},destroy:function(){this.cleanForSave();this._super.apply(this,arguments);this.$target.removeData('snippet-editor');this.$target.off('.snippet_editor');},buildSnippet:function(){for(var i in this.styles){this.styles[i].onBuilt();}},cleanForSave:function(){if(this.isDestroyed()){return;}
_.each(this.styles,function(option){option.cleanForSave();});},cover:function(){if(this._targetIsAnimated){return;}
var offset=this.$target.offset();var manipulatorOffset=this.$el.parent().offset();offset.top-=manipulatorOffset.top;offset.left-=manipulatorOffset.left;this.$el.css({width:this.$target.outerWidth(),left:offset.left,top:offset.top,});this.$('.o_handles').css('height',this.$target.outerHeight());this.$el.toggleClass('o_top_cover',offset.top<15);},removeSnippet:function(){this.toggleFocus(false);this.trigger_up('call_for_each_child_snippet',{$snippet:this.$target,callback:function(editor,$snippet){for(var i in editor.styles){editor.styles[i].onRemove();}},});var $parent=this.$target.parent();this.$target.find('*').andSelf().tooltip('dispose');this.$target.remove();this.$el.remove();var node=$parent[0];if(node&&node.firstChild){$.summernote.core.dom.removeSpace(node,node.firstChild,0,node.lastChild,1);if(!node.firstChild.tagName&&node.firstChild.textContent===' '){node.removeChild(node.firstChild);}}
if($parent.closest(':data("snippet-editor")').length){while(!$parent.data('snippet-editor')){var $nextParent=$parent.parent();if($parent.children().length===0&&$parent.text().trim()===''&&!$parent.hasClass('oe_structure')){$parent.remove();}
$parent=$nextParent;}
if($parent.children().length===0&&$parent.text().trim()===''&&!$parent.hasClass('oe_structure')){_.defer(function(){$parent.data('snippet-editor').removeSnippet();});}}
$('.note-control-selection').hide();$('.o_table_handler').remove();this.trigger_up('snippet_removed');this.destroy();},toggleFocus:function(focus){var do_action=(focus?_do_action_focus:_do_action_blur);var $style_button=this.$el.find('.oe_options');var $ul=$style_button.find('.dropdown-menu:first');var $headers=$ul.find('.dropdown-header:data(editor)');_.each($headers,(function(el){var $el=$(el);var styles=_.values($el.data('editor').styles);if($el.data('editor')!==this){styles=_.filter(styles,function(option){return!option.preventChildPropagation;});}
var count=0;_.each(_.sortBy(styles,'__order').reverse(),function(style){if(do_action(style,$el)){count++;}});$el.toggleClass('d-none',count===0);}).bind(this));$style_button.toggleClass('d-none',$ul.children(':not(.o_main_header):not(.dropdown-divider):not(.d-none)').length===0);this.cover();this.$el.toggleClass('oe_active',!!focus);function _do_action_focus(style,$dest){style.$el.insertAfter($dest);style.onFocus();return(style.$el.length>0);}
function _do_action_blur(style,$dest){style.$el.detach();style.onBlur();return false;}},clone:function(recordUndo){this.trigger_up('snippet_will_be_cloned',{$target:this.$target});var $clone=this.$target.clone(false);if(recordUndo){this.trigger_up('request_history_undo_record',{$target:this.$target});}
this.$target.after($clone);this.trigger_up('call_for_each_child_snippet',{$snippet:$clone,callback:function(editor,$snippet){for(var i in editor.styles){editor.styles[i].onClone({isCurrent:($snippet.is($clone)),});}},});this.trigger_up('snippet_cloned',{$target:$clone,$origin:this.$target});},_getName:function(){if(this.$target.data('name')!==undefined){return this.$target.data('name');}
if(this.$target.parent('.row').length){return _t("Column");}
return _t("Block");},_initializeOptions:function(){var self=this;var $styles=this.$el.find('.oe_options');var $ul=$styles.find('.dropdown-menu:first');this.styles={};this.selectorSiblings=[];this.selectorChildren=[];var i=0;$ul.append($('<div/>',{class:'dropdown-header o_main_header',text:this._getName()}).data('editor',this));var defs=_.map(this.templateOptions,function(val,option_id){if(!val.selector.is(self.$target)){return;}
if(val['drop-near'])self.selectorSiblings.push(val['drop-near']);if(val['drop-in'])self.selectorChildren.push(val['drop-in']);var optionName=val.option;var $el=val.$el.children().clone(true).addClass('snippet-option-'+optionName);var option=new(options.registry[optionName]||options.Class)(self,val.base_target?self.$target.find(val.base_target).eq(0):self.$target,self.$el,val.data);var key=optionName||_.uniqueId('option');if(self.styles[key]){key=_.uniqueId(key);}
self.styles[key]=option;option.__order=i++;return option.attachTo($el);});$ul.append($('<div/>',{class:'dropdown-divider mt-2'}));var $parents=this.$target.parents();_.each($parents,function(parent){var parentEditor=$(parent).data('snippet-editor');if(parentEditor){for(var styleName in parentEditor.styles){if(!parentEditor.styles[styleName].preventChildPropagation){$ul.append($('<div/>',{class:'dropdown-header o_parent_editor_header',text:parentEditor._getName()}).data('editor',parentEditor));break;}}}});if(!this.selectorSiblings.length&&!this.selectorChildren.length){this.$el.find('.oe_snippet_move, .oe_snippet_clone').addClass('d-none');}
this.$el.find('[data-toggle="dropdown"]').dropdown();return $.when.apply($,defs);},_onCloneClick:function(ev){ev.preventDefault();this.clone(true);},_onCoverUpdate:function(){this.cover();},_onDragAndDropStart:function(){var self=this;this.dropped=false;self.size={width:self.$target.width(),height:self.$target.height()};self.$target.after('<div class="oe_drop_clone" style="display: none;"/>');self.$target.detach();self.$el.addClass('d-none');var $selectorSiblings;for(var i=0;i<self.selectorSiblings.length;i++){if(!$selectorSiblings)$selectorSiblings=self.selectorSiblings[i].all();else $selectorSiblings=$selectorSiblings.add(self.selectorSiblings[i].all());}
var $selectorChildren;for(i=0;i<self.selectorChildren.length;i++){if(!$selectorChildren)$selectorChildren=self.selectorChildren[i].all();else $selectorChildren=$selectorChildren.add(self.selectorChildren[i].all());}
this.trigger_up('go_to_parent',{$snippet:this.$target});this.trigger_up('activate_insertion_zones',{$selectorSiblings:$selectorSiblings,$selectorChildren:$selectorChildren,});$('body').addClass('move-important');$('.oe_drop_zone').droppable({over:function(){if(self.dropped){self.$target.detach();$('.oe_drop_zone').removeClass('invisible');}
self.dropped=true;$(this).first().after(self.$target).addClass('invisible');},out:function(){var prev=self.$target.prev();if(this===prev[0]){self.dropped=false;self.$target.detach();$(this).removeClass('invisible');}},});},_onDragAndDropStop:function(ev,ui){var self=this;if(!this.dropped){var $el=$.nearest({x:ui.position.left,y:ui.position.top},'.oe_drop_zone').first();if($el.length){$el.after(this.$target);this.dropped=true;}}
$('.oe_drop_zone').droppable('destroy').remove();var prev=this.$target.first()[0].previousSibling;var next=this.$target.last()[0].nextSibling;var $parent=this.$target.parent();var $clone=$('.oe_drop_clone');if(prev===$clone[0]){prev=$clone[0].previousSibling;}else if(next===$clone[0]){next=$clone[0].nextSibling;}
$clone.after(this.$target);this.$el.removeClass('d-none');$('body').removeClass('move-important');$clone.remove();if(this.dropped){this.trigger_up('request_history_undo_record',{$target:this.$target});if(prev){this.$target.insertAfter(prev);}else if(next){this.$target.insertBefore(next);}else{$parent.prepend(this.$target);}
for(var i in this.styles){this.styles[i].onMove();}}
self.trigger_up('drag_and_drop_stop',{$snippet:self.$target,});},_onOptionUpdate:function(ev){var self=this;if(ev.data.optionNames){ev.stopPropagation();_.each(ev.data.optionNames,function(name){notifyForEachMatchedOption(name);});}
if(ev.data.optionName){if(notifyForEachMatchedOption(ev.data.optionName)){ev.stopPropagation();}}
function notifyForEachMatchedOption(name){var regex=new RegExp('^'+name+'\\d+$');var hasOption=false;for(var key in self.styles){if(key===name||regex.test(key)){self.styles[key].notify(ev.data.name,ev.data.data);hasOption=true;}}
return hasOption;}},_onParentButtonClick:function(ev){ev.preventDefault();this.trigger_up('go_to_parent',{$snippet:this.$target,});},_onRemoveClick:function(ev){ev.preventDefault();this.trigger_up('request_history_undo_record',{$target:this.$target});this.removeSnippet();},});var SnippetsMenu=Widget.extend({id:'oe_snippets',activeSnippets:[],custom_events:{activate_insertion_zones:'_onActivateInsertionZones',call_for_each_child_snippet:'_onCallForEachChildSnippet',clone_snippet:'_onCloneSnippet',deactivate_snippet:'_onDeactivateSnippet',drag_and_drop_stop:'_onDragAndDropStop',go_to_parent:'_onGoToParent',remove_snippet:'_onRemoveSnippet',snippet_removed:'_onSnippetRemoved',},init:function(parent,$editable){this._super.apply(this,arguments);this.$editable=$editable;this.$activeSnippet=false;this.snippetEditors=[];},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];var $document=$(document);var $window=$(window);var url=this._getSnippetURL();defs.push(this._rpc({route:url}).then(function(html){return self._computeSnippetTemplates(html);}));this.$snippetEditorArea=$('<div/>',{id:'oe_manipulators',}).insertAfter(this.$el);var lastClickedElement;$document.on('click.snippets_menu','*',function(ev){var srcElement=ev.srcElement||(ev.originalEvent&&(ev.originalEvent.originalTarget||ev.originalEvent.target)||ev.target);if(lastClickedElement===srcElement||!srcElement){return;}
lastClickedElement=srcElement;_.defer(function(){lastClickedElement=false;});var $target=$(srcElement);if($target.closest('.oe_overlay, .note-popover').length){return;}
self._activateSnippet($target);});core.bus.on('deactivate_snippet',this,this._onDeactivateSnippet);core.bus.on('snippet_editor_clean_for_save',this,this._onCleanForSaveDemand);var _isNotBreakable=$.summernote.core.dom.isNotBreakable;$.summernote.core.dom.isNotBreakable=function(node){return _isNotBreakable(node)||$(node).is('div')||globalSelector.is($(node));};var debouncedCoverUpdate=_.debounce(function(){self._updateCurrentSnippetEditorOverlay();},200);$window.on('resize.snippets_menu',debouncedCoverUpdate);$window.on('content_changed.snippets_menu',debouncedCoverUpdate);$document.on('keydown.snippets_menu',function(){if(self.$activeSnippet&&self.$activeSnippet.data('snippet-editor')){self.$activeSnippet.data('snippet-editor').$el.addClass('o_keypress');}});$document.on('mousemove.snippets_menu',function(){if(self.$activeSnippet&&self.$activeSnippet.data('snippet-editor')){self.$activeSnippet.data('snippet-editor').$el.removeClass('o_keypress');}});$document.on('click.snippets_menu','.o_default_snippet_text',function(ev){$(ev.target).selectContent();});$document.on('keyup.snippets_menu',function(){var r=$.summernote.core.range.create();$(r&&r.sc).closest('.o_default_snippet_text').removeClass('o_default_snippet_text');});return $.when.apply($,defs).then(function(){setTimeout(function(){$window.trigger('resize');},1000);});},destroy:function(){this._super.apply(this,arguments);this.$snippetEditorArea.remove();$(window).off('.snippets_menu');$(document).off('.snippets_menu');core.bus.off('deactivate_snippet',this,this._onDeactivateSnippet);core.bus.off('snippet_editor_clean_for_save',this,this._onCleanForSaveDemand);},cleanForSave:function(){this.trigger_up('ready_to_clean_for_save');this._destroyEditors();this.$editable.find('[contentEditable]').removeAttr('contentEditable').removeProp('contentEditable');this.$editable.find('.o_we_selected_image').removeClass('o_we_selected_image');},_activateInsertionZones:function($selectorSiblings,$selectorChildren){var zone_template=$('<div/>',{class:'oe_drop_zone oe_insert',});function setDropZoneDirection($drop,$elem,height,$parent,$sibling){$sibling=$sibling||$elem;var css=window.getComputedStyle($elem[0]);var parentCss=window.getComputedStyle($parent[0]);var float=css.float||css.cssFloat;var display=parentCss.display;var flex=parentCss.flexDirection;if(float==='left'||float==='right'||(display==='flex'&&flex==='row')){$drop.css('float',float);if($sibling.parent().width()!==$sibling.outerWidth(true)){$drop.addClass('oe_vertical').css('height',height);}}}
function testPreviousSibling($drop,$zone){var node=$drop[0].previousSibling;var test=!!(node&&((!node.tagName&&node.textContent.match(/\S/))||node.tagName==='BR'));if(test){$drop.addClass('oe_vertical').css({height:parseInt(window.getComputedStyle($zone[0]).lineHeight),float:'none',display:'inline-block',});return true;}else{return false;}}
var $clone=$('.oe_drop_clone');if($clone.length){var $drop=zone_template.clone();var neighbor=$clone.prev()[0]||$clone.next()[0];if(neighbor){var $neighbor=$(neighbor);var height=Math.max($neighbor.outerHeight(),30);setDropZoneDirection($drop,$neighbor,height,$neighbor.parent());}
$clone.after($drop);}
if($selectorChildren){$selectorChildren.each(function(){var $zone=$(this);var $drop=zone_template.clone();var $children=$zone.find('> :not(.oe_drop_zone, .oe_drop_clone)');var height;if(!$zone.children().last().is('.oe_drop_zone')){$zone.append($drop);if(!testPreviousSibling($drop,$zone)){var $lastChild=$children.last();height=Math.max(Math.min($zone.outerHeight(),$lastChild.outerHeight()),30);setDropZoneDirection($drop,$zone,height,$zone,$lastChild);}}
if(!$zone.children().first().is('.oe_drop_clone')){$drop=zone_template.clone();$zone.prepend($drop);if(!testPreviousSibling($drop,$zone)){var $firstChild=$children.first();height=Math.max(Math.min($zone.outerHeight(),$firstChild.outerHeight()),30);setDropZoneDirection($drop,$zone,height,$zone,$firstChild);}else{$drop.css({'float':'none','display':'inline-block'});}}});$selectorSiblings=$(_.uniq(($selectorSiblings||$()).add($selectorChildren.children()).get()));}
if($selectorSiblings){$selectorSiblings.filter(':not(.oe_drop_zone):not(.oe_drop_clone)').each(function(){var $zone=$(this);var $drop;var height;if($zone.prev('.oe_drop_zone:visible, .oe_drop_clone').length===0){$drop=zone_template.clone();height=Math.max(Math.min($zone.outerHeight(),$zone.prev().outerHeight()||Infinity),30);setDropZoneDirection($drop,$zone,height,$zone.parent());$zone.before($drop);}
if($zone.next('.oe_drop_zone:visible, .oe_drop_clone').length===0){$drop=zone_template.clone();height=Math.max(Math.min($zone.outerHeight(),$zone.next().outerHeight()||Infinity),30);setDropZoneDirection($drop,$zone,height,$zone.parent());$zone.after($drop);}});}
var count;var $zones;do{count=0;$zones=this.$editable.find('.oe_drop_zone > .oe_drop_zone').remove();count+=$zones.length;$zones.remove();}while(count>0);$zones=this.$editable.find('.oe_drop_zone:not(.oe_vertical)');$zones.each(function(){var zone=$(this);var prev=zone.prev();var next=zone.next();if(prev.is('.oe_drop_zone')||next.is('.oe_drop_zone')){zone.remove();return;}
var float_prev=prev.css('float')||'none';var float_next=next.css('float')||'none';var disp_prev=prev.css('display')||null;var disp_next=next.css('display')||null;if((float_prev==='left'||float_prev==='right')&&(float_next==='left'||float_next==='right')){zone.remove();}else if(disp_prev!==null&&disp_next!==null&&disp_prev.indexOf('inline')>=0&&disp_next.indexOf('inline')>=0){zone.remove();}});},_activateSnippet:function($snippet){if($snippet){if(!globalSelector.is($snippet)){$snippet=globalSelector.closest($snippet);}
if(this.$activeSnippet&&this.$activeSnippet[0]===$snippet[0]){return $.when();}}
if(this.$activeSnippet){if(this.$activeSnippet.data('snippet-editor')){this.$activeSnippet.data('snippet-editor').toggleFocus(false);}
this.$activeSnippet=false;}
if($snippet&&$snippet.length){var self=this;return this._createSnippetEditor($snippet).then(function(){self.$activeSnippet=$snippet;if(self.$activeSnippet.data('snippet-editor')){self.$activeSnippet.data('snippet-editor').toggleFocus(true);}});}
return $.when();},_destroyEditors:function(){_.each(this.snippetEditors,function(snippetEditor){snippetEditor.destroy();});this.snippetEditors.splice(0);},_updateCurrentSnippetEditorOverlay:function(){if(this.$activeSnippet&&this.$activeSnippet.data('snippet-editor')){this.$activeSnippet.data('snippet-editor').cover();}},_callForEachChildSnippet:function($snippet,callback){var self=this;var defs=_.map($snippet.add(globalSelector.all($snippet)),function(el){var $snippet=$(el);return self._createSnippetEditor($snippet).then(function(editor){if(editor){return callback.call(self,editor,$snippet);}});});return $.when.apply($,defs);},_computeSelectorFunctions:function(include,exclude,target,noCheck,isChildren){var self=this;var selectorList=_.compact(include.split(/\s*,\s*/));var excludeList=_.compact(exclude.split(/\s*,\s*/));excludeList.push('.o_snippet_not_selectable');var selectorConditions=_.map(excludeList,function(exc){return':not('+exc+')';}).join('');if(target){selectorConditions+=':has('+target+')';}
if(!noCheck){selectorConditions=':o_editable'+selectorConditions;}
var selector=_.map(selectorList,function(s){return s+selectorConditions;}).join(', ');var functions={is:function($from){return $from.is(selector);},};if(noCheck){functions.closest=function($from,parentNode){return $from.closest(selector,parentNode);};functions.all=function($from){return $from?dom.cssFind($from,selector):$(selector);};}else{functions.closest=function($from,parentNode){var parents=self.$editable.get();return $from.closest(selector,parentNode).filter(function(){var node=this;while(node.parentNode){if(parents.indexOf(node)!==-1){return true;}
node=node.parentNode;}
return false;});};functions.all=isChildren?function($from){return dom.cssFind($from||self.$editable,selector);}:function($from){$from=$from||self.$editable;return $from.filter(selector).add(dom.cssFind($from,selector));};}
return functions;},_computeSnippetTemplates:function(html){var self=this;var $html=$(html);var $scroll=$html.siblings('#o_scroll');$html.find('[data-oe-type="snippet"]').each(function(){$(this).children().attr('data-oe-type','snippet').attr('data-oe-thumbnail',$(this).data('oe-thumbnail'));});this.templateOptions=[];var selectors=[];var $styles=$html.find('[data-selector]');$styles.each(function(){var $style=$(this);var selector=$style.data('selector');var exclude=$style.data('exclude')||'';var target=$style.data('target');var noCheck=$style.data('no-check');var option_id=$style.data('js');var option={'option':option_id,'base_selector':selector,'base_exclude':exclude,'base_target':target,'selector':self._computeSelectorFunctions(selector,exclude,target,noCheck),'$el':$style,'drop-near':$style.data('drop-near')&&self._computeSelectorFunctions($style.data('drop-near'),'',false,noCheck,true),'drop-in':$style.data('drop-in')&&self._computeSelectorFunctions($style.data('drop-in'),'',false,noCheck),'data':$style.data(),};self.templateOptions.push(option);selectors.push(option.selector);});$styles.addClass('d-none');globalSelector.closest=function($from){var $temp;var $target;for(var i=0,len=selectors.length;i<len;i++){$temp=selectors[i].closest($from,$target&&$target[0]);if($temp.length){$target=$temp;}}
return $target||$();};globalSelector.all=function($from){var $target=$();for(var i=0,len=selectors.length;i<len;i++){$target=$target.add(selectors[i].all($from));}
return $target;};globalSelector.is=function($from){for(var i=0,len=selectors.length;i<len;i++){if(selectors[i].is($from)){return true;}}
return false;};this.$snippets=$scroll.find('.o_panel_body').children().addClass('oe_snippet').each(function(){var $snippet=$(this);var name=$snippet.attr('name');var $sbody=$snippet.children(':not(.oe_snippet_thumbnail)').addClass('oe_snippet_body');if($sbody.length){var snippetClasses=$sbody.attr('class').match(/s_[^ ]+/g);if(snippetClasses&&snippetClasses.length){snippetClasses='.'+snippetClasses.join('.');}
$(snippetClasses).data('name',name);$sbody.data('name',name);}
if($snippet.find('.oe_snippet_thumbnail').length){return;}
var $thumbnail=$(_.str.sprintf('<div class="oe_snippet_thumbnail">'+'<div class="oe_snippet_thumbnail_img" style="background-image: url(%s);"/>'+'<span class="oe_snippet_thumbnail_title">%s</span>'+'</div>',$snippet.find('[data-oe-thumbnail]').data('oeThumbnail'),name));$snippet.prepend($thumbnail);var moduleID=$snippet.data('moduleId');if(moduleID){$snippet.addClass('o_snippet_install');var $installBtn=$('<a/>',{class:'btn btn-primary o_install_btn',target:'_blank',href:'/web#id='+moduleID+'&view_type=form&model=ir.module.module&action=base.open_module_tree',text:_t("Install"),});$thumbnail.append($installBtn);}}).not('[data-module-id]');if(!this.$snippets.length){this.$el.detach();}
$('body').toggleClass('editor_has_snippets',this.$snippets.length>0);this._registerDefaultTexts();_.each($html.find('[data-oe-model], [data-oe-type]'),function(el){for(var k=0;k<el.attributes.length;k++){if(el.attributes[k].name.indexOf('data-oe-')===0){$(el).removeAttr(el.attributes[k].name);k--;}}});$html.find('.o_not_editable').attr('contentEditable',false);this.$el.html($html);this._makeSnippetDraggable(this.$snippets);this._disableUndroppableSnippets();},_createSnippetEditor:function($snippet){var self=this;var snippetEditor=$snippet.data('snippet-editor');if(snippetEditor){return snippetEditor.__isStarted;}
var def;var $parent=globalSelector.closest($snippet.parent());if($parent.length){def=this._createSnippetEditor($parent);}
return $.when(def).then(function(parentEditor){snippetEditor=$snippet.data('snippet-editor');if(snippetEditor){return snippetEditor.__isStarted;}
snippetEditor=new SnippetEditor(parentEditor||self,$snippet,self.templateOptions);self.snippetEditors.push(snippetEditor);return snippetEditor.appendTo(self.$snippetEditorArea);}).then(function(){return snippetEditor;});},_disableUndroppableSnippets:function(){var self=this;var cache={};this.$snippets.each(function(){var $snippet=$(this);var $snippet_body=$snippet.find('.oe_snippet_body');var check=false;_.each(self.templateOptions,function(option,k){if(check||!($snippet_body.is(option.base_selector)&&!$snippet_body.is(option.base_exclude)))return;cache[k]=cache[k]||{'drop-near':option['drop-near']?option['drop-near'].all().length:0,'drop-in':option['drop-in']?option['drop-in'].all().length:0};check=(cache[k]['drop-near']||cache[k]['drop-in']);});$snippet.toggleClass('o_disabled',!check);});},_getSnippetURL:function(){return odoo.snippetsURL||'/web_editor/snippets';},_makeSnippetDraggable:function($snippets){var self=this;var $tumb=$snippets.find('.oe_snippet_thumbnail_img:first');var left=$tumb.outerWidth()/2;var top=$tumb.outerHeight()/2;var $toInsert,dropped,$snippet;$snippets.draggable({greedy:true,helper:'clone',zIndex:'1000',appendTo:'body',cursor:'move',handle:'.oe_snippet_thumbnail',distance:30,cursorAt:{left:left,top:top,},start:function(){dropped=false;$snippet=$(this);var $base_body=$snippet.find('.oe_snippet_body');var $selectorSiblings=$();var $selectorChildren=$();var temp=self.templateOptions;for(var k in temp){if($base_body.is(temp[k].base_selector)&&!$base_body.is(temp[k].base_exclude)){if(temp[k]['drop-near']){if(!$selectorSiblings)$selectorSiblings=temp[k]['drop-near'].all();else $selectorSiblings=$selectorSiblings.add(temp[k]['drop-near'].all());}
if(temp[k]['drop-in']){if(!$selectorChildren)$selectorChildren=temp[k]['drop-in'].all();else $selectorChildren=$selectorChildren.add(temp[k]['drop-in'].all());}}}
$toInsert=$base_body.clone().data('name',$base_body.data('name'));if(!$selectorSiblings.length&&!$selectorChildren.length){console.warn($snippet.find('.oe_snippet_thumbnail_title').text()+" have not insert action: data-drop-near or data-drop-in");return;}
self._activateSnippet(false);self._activateInsertionZones($selectorSiblings,$selectorChildren);$('.oe_drop_zone').droppable({over:function(){if(dropped){$toInsert.detach();$('.oe_drop_zone').removeClass('invisible');}
dropped=true;$(this).first().after($toInsert).addClass('invisible');},out:function(){var prev=$toInsert.prev();if(this===prev[0]){dropped=false;$toInsert.detach();$(this).removeClass('invisible');}},});},stop:function(ev,ui){$toInsert.removeClass('oe_snippet_body');if(!dropped&&ui.position.top>3&&ui.position.left+50>self.$el.outerWidth()){var $el=$.nearest({x:ui.position.left,y:ui.position.top},'.oe_drop_zone').first();if($el.length){$el.after($toInsert);dropped=true;}}
self.$editable.find('.oe_drop_zone').droppable('destroy').remove();if(dropped){var prev=$toInsert.first()[0].previousSibling;var next=$toInsert.last()[0].nextSibling;if(prev){$toInsert.detach();self.trigger_up('request_history_undo_record',{$target:$(prev)});$toInsert.insertAfter(prev);}else if(next){$toInsert.detach();self.trigger_up('request_history_undo_record',{$target:$(next)});$toInsert.insertBefore(next);}else{var $parent=$toInsert.parent();$toInsert.detach();self.trigger_up('request_history_undo_record',{$target:$parent});$parent.prepend($toInsert);}
$toInsert.closest('.o_editable').trigger('content_changed');var $target=$toInsert;_.defer(function(){self.trigger_up('snippet_dropped',{$target:$target});self._disableUndroppableSnippets();self._callForEachChildSnippet($target,function(editor,$snippet){_.defer(function(){editor.buildSnippet();});}).then(function(){$target.closest('.o_editable').trigger('content_changed');self._activateSnippet($target);});});}else{$toInsert.remove();}},});},_registerDefaultTexts:function($in){if($in===undefined){$in=this.$snippets.find('.oe_snippet_body');}
$in.find('*').addBack().contents().filter(function(){return this.nodeType===3&&this.textContent.match(/\S/);}).parent().addClass('o_default_snippet_text');},_onActivateInsertionZones:function(ev){this._activateInsertionZones(ev.data.$selectorSiblings,ev.data.$selectorChildren);},_onCallForEachChildSnippet:function(ev){this._callForEachChildSnippet(ev.data.$snippet,ev.data.callback);},_onCleanForSaveDemand:function(ev){this.cleanForSave();},_onCloneSnippet:function(ev){ev.stopPropagation();this._createSnippetEditor(ev.data.$snippet).then(function(editor){editor.clone();});},_onDeactivateSnippet:function(){this._activateSnippet(false);},_onDragAndDropStop:function(ev){this._destroyEditors();this._activateSnippet(ev.data.$snippet);},_onGoToParent:function(ev){ev.stopPropagation();this._activateSnippet(ev.data.$snippet.parent());},_onRemoveSnippet:function(ev){ev.stopPropagation();this._createSnippetEditor(ev.data.$snippet).then(function(editor){editor.removeSnippet();});},_onSnippetRemoved:function(){this._disableUndroppableSnippets();},});return{Class:SnippetsMenu,Editor:SnippetEditor,globalSelector:globalSelector,};});;

/* /web_editor/static/src/js/editor/snippets.options.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.snippets.options',function(require){'use strict';var core=require('web.core');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var summernoteCustomColors=require('web_editor.rte.summernote_custom_colors');var weWidgets=require('web_editor.widget');var qweb=core.qweb;var _t=core._t;var SnippetOption=Widget.extend({events:{'mouseenter':'_onLinkEnter','mouseenter .dropdown-item':'_onLinkEnter','click':'_onLinkClick','mouseleave':'_onMouseleave','mouseleave .dropdown-item':'_onMouseleave',},preventChildPropagation:false,init:function(parent,$target,$overlay,data){this._super.apply(this,arguments);this.$target=$target;this.$overlay=$overlay;this.data=data;this.__methodNames=[];},start:function(){this._setActive();return this._super.apply(this,arguments);},onFocus:function(){},onBuilt:function(){},onBlur:function(){},onClone:function(options){},onMove:function(){},onRemove:function(){},cleanForSave:function(){},selectClass:function(previewMode,value,$opt){var $group=$opt&&$opt.parents('.dropdown-submenu').last();if(!$group||!$group.length){$group=this.$el;}
var $lis=$group.find('[data-select-class]').addBack('[data-select-class]');var classes=$lis.map(function(){return $(this).data('selectClass');}).get().join(' ');this.$target.removeClass(classes);if(value){this.$target.addClass(value);}},toggleClass:function(previewMode,value,$opt){var $lis=this.$el.find('[data-toggle-class]').addBack('[data-toggle-class]');var classes=$lis.map(function(){return $(this).data('toggleClass');}).get().join(' ');var activeClasses=$lis.filter('.active, :has(.active)').map(function(){return $(this).data('toggleClass');}).get().join(' ');this.$target.removeClass(classes).addClass(activeClasses);if(value&&previewMode!=='reset'){this.$target.toggleClass(value);}},$:function(){return this.$target.find.apply(this.$target,arguments);},notify:function(name,data){if(name==='target'){this.setTarget(data);}},setTarget:function($target){this.$target=$target;this._setActive();this.$target.trigger('snippet-option-change',[this]);},_reset:function(){var self=this;var $actives=this.$el.find('.active').addBack('.active');_.each($actives,function(activeElement){var $activeElement=$(activeElement);self.__methodNames=_.without.apply(_,[self.__methodNames].concat(_.keys($activeElement.data())));self._select('reset',$activeElement);});_.each(this.__methodNames,function(methodName){self[methodName]('reset');});this.__methodNames=[];},_select:function(previewMode,$opt){var self=this;if(previewMode&&($opt.data('noPreview')||$opt.parent().data('noPreview'))){return;}
if(!previewMode){this._reset();this.trigger_up('request_history_undo_record',{$target:this.$target});}
var el=$opt[0];var methods=[];do{methods.push([el,el.dataset]);el=el.parentNode;}while(this.$el.parent().has(el).length);_.each(methods.reverse(),function(data){var $el=$(data[0]);var methods=data[1];_.each(methods,function(value,methodName){if(self[methodName]){if(previewMode===true){self.__methodNames.push(methodName);}
self[methodName](previewMode,value,$el);}});});this.__methodNames=_.uniq(this.__methodNames);if(!previewMode){this._setActive();}},_setActive:function(){var self=this;this.$el.find('[data-toggle-class]').addBack('[data-toggle-class]').removeClass('active').filter(function(){var className=$(this).data('toggleClass');return!className||self.$target.hasClass(className);}).addClass('active');var $submenus=this.$el.find('.dropdown-submenu').addBack('.dropdown-submenu').not('.dropdown-submenu .dropdown-submenu');_.each($submenus,function(submenu){var $elements=_getSelectClassElements($(submenu));_processSelectClassElements($elements);});var $externalElements=_getSelectClassElements(this.$el).not('.dropdown-submenu *, .dropdown-submenu');_processSelectClassElements($externalElements);function _getSelectClassElements($el){return $el.find('[data-select-class]').addBack('[data-select-class]');}
function _processSelectClassElements($elements){var maxNbClasses=-1;$elements.removeClass('active').filter(function(){var className=$(this).data('selectClass');var nbClasses=className?className.split(' ').length:0;if(nbClasses>=maxNbClasses&&(!className||self.$target.hasClass(className))){maxNbClasses=nbClasses;return true;}
return false;}).last().addClass('active');}},_onLinkEnter:function(ev){var $opt=$(ev.target).closest('.dropdown-item');if(!$opt.length){return;}
var $dsmenu=$opt.parent('.dropdown-submenu');if($dsmenu.length){var $menu=$dsmenu.children('.dropdown-menu');if($menu.length){var menuRightPosition=$dsmenu.offset().left+$dsmenu.outerWidth()+$menu.outerWidth();$menu.toggleClass('o_open_to_left',menuRightPosition>$(window).outerWidth());}}
if(!$opt.is(':hasData')){return;}
this.__click=false;this._select(true,$opt);this.$target.trigger('snippet-option-preview',[this]);},_onLinkClick:function(ev){var $opt=$(ev.target).closest('.dropdown-item');if(!$opt.length||!$opt.is(':hasData')){return;}
ev.preventDefault();this.__click=true;this._select(false,$opt);this.$target.trigger('snippet-option-change',[this]);},_onMouseleave:function(){if(this.__click){return;}
this._reset();},});var registry={};registry.sizing=SnippetOption.extend({preventChildPropagation:true,start:function(){var self=this;var def=this._super.apply(this,arguments);this.$handles=this.$overlay.find('.o_handle');var resizeValues=this._getSize();_.each(resizeValues,function(value,key){self.$handles.filter('.'+key).toggleClass('readonly',!value);});this.$handles.on('mousedown',function(ev){ev.preventDefault();resizeValues=self._getSize();var $handle=$(ev.currentTarget);var compass=false;var XY=false;if($handle.hasClass('n')){compass='n';XY='Y';}else if($handle.hasClass('s')){compass='s';XY='Y';}else if($handle.hasClass('e')){compass='e';XY='X';}else if($handle.hasClass('w')){compass='w';XY='X';}
var resize=resizeValues[compass];if(!resize){return;}
var current=0;var cssProperty=resize[2];var cssPropertyValue=parseInt(self.$target.css(cssProperty));_.each(resize[0],function(val,key){if(self.$target.hasClass(val)){current=key;}else if(resize[1][key]===cssPropertyValue){current=key;}});var begin=current;var beginClass=self.$target.attr('class');var regClass=new RegExp('\\s*'+resize[0][begin].replace(/[-]*[0-9]+/,'[-]*[0-9]+'),'g');var cursor=$handle.css('cursor')+'-important';var $body=$(document.body);$body.addClass(cursor);var xy=ev['page'+XY];var body_mousemove=function(ev){ev.preventDefault();var dd=ev['page'+XY]-xy+resize[1][begin];var next=current+(current+1===resize[1].length?0:1);var prev=current?(current-1):0;var change=false;if(dd>(2*resize[1][next]+resize[1][current])/3){self.$target.attr('class',(self.$target.attr('class')||'').replace(regClass,''));self.$target.addClass(resize[0][next]);current=next;change=true;}
if(prev!==current&&dd<(2*resize[1][prev]+resize[1][current])/3){self.$target.attr('class',(self.$target.attr('class')||'').replace(regClass,''));self.$target.addClass(resize[0][prev]);current=prev;change=true;}
if(change){self._onResize(compass,beginClass,current);self.trigger_up('cover_update');$handle.addClass('o_active');}};var body_mouseup=function(){$body.off('mousemove',body_mousemove);$(window).off('mouseup',body_mouseup);$body.removeClass(cursor);$handle.removeClass('o_active');var $handlers=self.$overlay.find('.o_handle');$handlers.addClass('o_active').delay(300).queue(function(){$handlers.removeClass('o_active').dequeue();});if(begin===current){return;}
setTimeout(function(){self.trigger_up('request_history_undo_record',{$target:self.$target,event:'resize_'+XY,});},0);};$body.on('mousemove',body_mousemove);$(window).on('mouseup',body_mouseup);});return def;},onFocus:function(){this._onResize();},setTarget:function(){this._super.apply(this,arguments);this._onResize();},_getSize:function(){},_onResize:function(compass,beginClass,current){var self=this;var resizeValues=this._getSize();var $handles=this.$overlay.find('.o_handle');_.each(resizeValues,function(resizeValue,direction){var classes=resizeValue[0];var values=resizeValue[1];var cssProperty=resizeValue[2];var $handle=$handles.filter('.'+direction);var current=0;var cssPropertyValue=parseInt(self.$target.css(cssProperty));_.each(classes,function(className,key){if(self.$target.hasClass(className)){current=key;}else if(values[key]===cssPropertyValue){current=key;}});$handle.toggleClass('o_handle_start',current===0);$handle.toggleClass('o_handle_end',current===classes.length-1);});var ml=this.$target.css('margin-left');this.$overlay.find('.o_handle.w').css({width:ml,left:'-'+ml,});_.each(this.$overlay.find(".o_handle.n, .o_handle.s"),function(handle){var $handle=$(handle);var direction=$handle.hasClass('n')?'top':'bottom';$handle.height(self.$target.css('padding-'+direction));});},});registry.sizing_y=registry.sizing.extend({_getSize:function(){var nClass='pt';var nProp='padding-top';var sClass='pb';var sProp='padding-bottom';if(this.$target.is('hr')){nClass='mt';nProp='margin-top';sClass='mb';sProp='margin-bottom';}
var grid=[];for(var i=0;i<=256/8;i++){grid.push(i*8);}
grid.splice(1,0,4);this.grid={n:[_.map(grid,function(v){return nClass+v;}),grid,nProp],s:[_.map(grid,function(v){return sClass+v;}),grid,sProp],};return this.grid;},});registry.colorpicker=SnippetOption.extend({xmlDependencies:['/web_editor/static/src/xml/snippets.xml'],events:_.extend({},SnippetOption.prototype.events||{},{'click .colorpicker button':'_onColorButtonClick','mouseenter .colorpicker button':'_onColorButtonEnter','mouseleave .colorpicker button':'_onColorButtonLeave','click .note-color-reset':'_onColorResetButtonClick',}),colorPrefix:'bg-',start:function(){var self=this;var res=this._super.apply(this,arguments);if(this.data.colorPrefix){this.colorPrefix=this.data.colorPrefix;}
if(!this.$el.find('.colorpicker').length){var $pt=$(qweb.render('web_editor.snippet.option.colorpicker'));var $clpicker=$(qweb.render('web_editor.colorpicker'));_.each($clpicker.find('.o_colorpicker_section'),function(elem){$(elem).prepend("<div class='text-muted mt8'>"+elem.dataset.display+"</div>");});var excluded=[];if(this.data.paletteExclude){excluded=this.data.paletteExclude.replace(/ /g,'').split(',');}
if(this.data.paletteTitle){$pt.find('.note-palette-title').text(this.data.paletteTitle);}
_.each(excluded,function(exc){$clpicker.find('[data-name="'+exc+'"]').addClass('d-none');});if(!('common'in excluded)){var $commonColorSection=$clpicker.find('[data-name="common"]');_.each(summernoteCustomColors,function(colorRow,i){var $div=$('<div/>',{class:'clearfix'}).appendTo($commonColorSection);if(i===0){return;}
_.each(colorRow,function(color){$div.append('<button class="o_custom_color" style="background-color: '+color+'" />');});});}
$pt.find('.o_colorpicker_section_tabs').append($clpicker);this.$el.find('.dropdown-menu').append($pt);}
this._addCompatibilityColors(['primary','secondary','success','info','warning','danger']);var classes=[];this.$el.find('.colorpicker button').each(function(){var $color=$(this);var color=$color.data('color');if(!color){return;}
$color.addClass('bg-'+color);var className=self.colorPrefix+color;if(self.$target.hasClass(className)){$color.addClass('selected');}
classes.push(className);});this.classes=classes.join(' ');return res;},_addCompatibilityColors:function(colorNames){var $colorpicker=this.$el.find('.colorpicker');_.each(colorNames,function(colorName){if(!$colorpicker.find('button[data-color="'+colorName+'"]').length){$colorpicker.append($('<button/>',{'class':'d-none','data-color':colorName}));}});},_onColorButtonClick:function(ev){this.$el.find('.colorpicker button.selected').removeClass('selected');$(ev.currentTarget).addClass('selected');this.$target.closest('.o_editable').trigger('content_changed');this.$target.trigger('background-color-event',false);},_onColorButtonEnter:function(ev){this.$target.removeClass(this.classes);var color=$(ev.currentTarget).data('color');if(color){this.$target.addClass(this.colorPrefix+color);}else if($(ev.target).hasClass('o_custom_color')){this.$target.removeClass(this.classes).css('background-color',ev.currentTarget.style.backgroundColor);}
this.$target.trigger('background-color-event',true);},_onColorButtonLeave:function(ev){this.$target.removeClass(this.classes);this.$target.css('background-color','');var $selected=this.$el.find('.colorpicker button.selected');if($selected.length){if($selected.data('color')){this.$target.addClass(this.colorPrefix+$selected.data('color'));}else if($selected.hasClass('o_custom_color')){this.$target.css('background-color',$selected.css('background-color'));}}
this.$target.trigger('background-color-event','reset');},_onColorResetButtonClick:function(){this.$target.removeClass(this.classes).css('background-color','');this.$target.trigger('content_changed');this.$el.find('.colorpicker button.selected').removeClass('selected');},});registry.background=SnippetOption.extend({start:function(){var res=this._super.apply(this,arguments);this.bindBackgroundEvents();this.__customImageSrc=this._getSrcFromCssValue();return res;},background:function(previewMode,value,$opt){if(previewMode==='reset'&&value===undefined){this._setCustomBackground(this.__customImageSrc);return;}
if(value&&value.length){this.$target.css('background-image','url(\''+value+'\')');this.$target.removeClass('oe_custom_bg').addClass('oe_img_bg');}else{this.$target.css('background-image','');this.$target.removeClass('oe_img_bg oe_custom_bg');}},selectClass:function(previewMode,value,$opt){this.background(previewMode,'',$opt);this._super(previewMode,value?(value+' oe_img_bg'):value,$opt);},chooseImage:function(previewMode,value,$opt){var $image=$('<img/>',{class:'d-none',src:value}).appendTo(this.$target);var $editable=this.$target.closest('.o_editable');var _editor=new weWidgets.MediaDialog(this,{onlyImages:true,res_model:$editable.data('oe-model'),res_id:$editable.data('oe-id'),},null,$image[0]).open();_editor.on('save',this,function(){this._setCustomBackground($image.attr('src'));});_editor.on('closed',this,function(){$image.remove();});},bindBackgroundEvents:function(){if(this.$target.is('.parallax, .s_parallax_bg')){return;}
this.$target.off('.background-option').on('background-color-event.background-option',(function(e,previewMode){e.stopPropagation();if(e.currentTarget!==e.target)return;if(previewMode===false){this.__customImageSrc=undefined;}
this.background(previewMode);}).bind(this));},setTarget:function(){this._super.apply(this,arguments);this.bindBackgroundEvents();this.__customImageSrc=this._getSrcFromCssValue();},_getSrcFromCssValue:function(value){if(value===undefined){value=this.$target.css('background-image');}
return value.replace(/url\(['"]*|['"]*\)|^none$/g,'');},_setActive:function(){this._super.apply(this,arguments);var src=this._getSrcFromCssValue();this.$el.find('[data-background]').removeClass('active').filter(function(){var bgOption=$(this).data('background');return(bgOption===''&&src===''||bgOption!==''&&src.indexOf(bgOption)>=0);}).addClass('active');this.$el.find('[data-choose-image]').toggleClass('active',this.$target.hasClass('oe_custom_bg'));},_setCustomBackground:function(value){this.__customImageSrc=value;this.background(false,this.__customImageSrc);this.$target.addClass('oe_custom_bg');this._setActive();this.$target.trigger('snippet-option-change',[this]);},});registry.background_position=SnippetOption.extend({xmlDependencies:['/web_editor/static/src/xml/editor.xml'],start:function(){this._super.apply(this,arguments);var self=this;this.$target.on('snippet-option-change',function(){self.onFocus();});},onFocus:function(){this.$el.toggleClass('d-none',this.$target.css('background-image')==='none');},backgroundPosition:function(previewMode,value,$opt){var self=this;this.previous_state=[this.$target.attr('class'),this.$target.css('background-size'),this.$target.css('background-position')];this.bg_pos=self.$target.css('background-position').split(' ');this.bg_siz=self.$target.css('background-size').split(' ');this.modal=new Dialog(null,{title:_t("Background Image Sizing"),$content:$(qweb.render('web_editor.dialog.background_position')),buttons:[{text:_t("Ok"),classes:'btn-primary',close:true,click:_.bind(this._saveChanges,this)},{text:_t("Discard"),close:true,click:_.bind(this._discardChanges,this)},],}).open();this.modal.opened().then(function(){var value=((self.$target.hasClass('o_bg_img_opt_contain'))?'contain':((self.$target.hasClass('o_bg_img_opt_custom'))?'custom':'cover'));self.modal.$('> label > input[value='+value+']').prop('checked',true);if(self.$target.hasClass('o_bg_img_opt_repeat')){self.modal.$('#o_bg_img_opt_contain_repeat').prop('checked',true);self.modal.$('#o_bg_img_opt_custom_repeat').val('o_bg_img_opt_repeat');}else if(self.$target.hasClass('o_bg_img_opt_repeat_x')){self.modal.$('#o_bg_img_opt_custom_repeat').val('o_bg_img_opt_repeat_x');}else if(self.$target.hasClass('o_bg_img_opt_repeat_y')){self.modal.$('#o_bg_img_opt_custom_repeat').val('o_bg_img_opt_repeat_y');}
if(self.bg_pos.length>1){self.bg_pos={x:self.bg_pos[0],y:self.bg_pos[1],};self.modal.$('#o_bg_img_opt_custom_pos_x').val(self.bg_pos.x.replace('%',''));self.modal.$('#o_bg_img_opt_custom_pos_y').val(self.bg_pos.y.replace('%',''));}
if(self.bg_siz.length>1){self.modal.$('#o_bg_img_opt_custom_size_x').val(self.bg_siz[0].replace('%',''));self.modal.$('#o_bg_img_opt_custom_size_y').val(self.bg_siz[1].replace('%',''));}
self.$focus=self.modal.$('.o_focus_point');self._updatePosInformation();var img_url=/\(['"]?([^'"]+)['"]?\)/g.exec(self.$target.css('background-image'));img_url=(img_url&&img_url[1])||'';var $img=$('<img/>',{class:'img img-fluid',src:img_url});$img.on('load',function(){self._bindImageEvents($img);});$img.prependTo(self.modal.$('.o_bg_img_opt_object'));self.modal.$el.on('change','> label > input',function(e){self.modal.$('> .o_bg_img_opt').addClass('o_hidden').filter('[data-value='+e.target.value+']').removeClass('o_hidden');});self.modal.$el.on('change','input, select',function(e){self._saveChanges();});self.modal.$('> label > input:checked').trigger('change');});},_bindImageEvents:function($img){var self=this;var mousedown=false;$img.on('mousedown',function(e){mousedown=true;});$img.on('mousemove',function(e){if(mousedown){_update(e);}});$img.on('mouseup',function(e){self.$focus.addClass('o_with_transition');_update(e);setTimeout(function(){self.$focus.removeClass('o_with_transition');},200);mousedown=false;});function _update(e){var posX=e.pageX-$(e.target).offset().left;var posY=e.pageY-$(e.target).offset().top;self.bg_pos={x:clipValue(posX/$img.width()*100).toFixed(2)+'%',y:clipValue(posY/$img.height()*100).toFixed(2)+'%',};self._updatePosInformation();self._saveChanges();function clipValue(value){return Math.max(0,Math.min(value,100));}}},_clean:function(){this.$target.removeClass('o_bg_img_opt_contain o_bg_img_opt_custom o_bg_img_opt_repeat o_bg_img_opt_repeat_x o_bg_img_opt_repeat_y').css({'background-size':'','background-position':'',});},_discardChanges:function(){this._clean();if(this.previous_state){this.$target.addClass(this.previous_state[0]).css({'background-size':this.previous_state[1],'background-position':this.previous_state[2],});}},_updatePosInformation:function(){this.modal.$('.o_bg_img_opt_ui_info .o_x').text(this.bg_pos.x);this.modal.$('.o_bg_img_opt_ui_info .o_y').text(this.bg_pos.y);this.$focus.css({left:this.bg_pos.x,top:this.bg_pos.y,});},_saveChanges:function(){this._clean();var bg_img_size=this.modal.$('> :not(label):not(.o_hidden)').data('value')||'cover';switch(bg_img_size){case'cover':this.$target.css('background-position',this.bg_pos.x+' '+this.bg_pos.y);break;case'contain':this.$target.addClass('o_bg_img_opt_contain');this.$target.toggleClass('o_bg_img_opt_repeat',this.modal.$('#o_bg_img_opt_contain_repeat').prop('checked'));break;case'custom':this.$target.addClass('o_bg_img_opt_custom');var sizeX=this.modal.$('#o_bg_img_opt_custom_size_x').val();var sizeY=this.modal.$('#o_bg_img_opt_custom_size_y').val();var posX=this.modal.$('#o_bg_img_opt_custom_pos_x').val();var posY=this.modal.$('#o_bg_img_opt_custom_pos_y').val();this.$target.addClass(this.modal.$('#o_bg_img_opt_custom_repeat').val()).css({'background-size':((sizeX)?sizeX+'%':'auto')+' '+((sizeY)?sizeY+'%':'auto'),'background-position':((posX)?posX+'%':'auto')+' '+((posY)?posY+'%':'auto'),});break;}},});registry.many2one=SnippetOption.extend({xmlDependencies:['/web_editor/static/src/xml/snippets.xml'],start:function(){var self=this;this.Model=this.$target.data('oe-many2one-model');this.ID=+this.$target.data('oe-many2one-id');this.$btn=$(qweb.render('web_editor.many2one.button')).insertAfter(this.$overlay.find('.oe_options'));this.$ul=this.$btn.find('ul');this.$search=this.$ul.find('li:first');this.$search.find('input').on('mousedown click mouseup keyup keydown',function(e){e.stopPropagation();});setTimeout(function(){if(self.$overlay.find('.oe_options').hasClass('d-none')){self.$btn.css('height','0').find('> a').addClass('d-none');self.$ul.show().css({'top':'-24px','margin':'0','padding':'2px 0','position':'relative'});}else{self.$btn.find('a').on('click',function(e){self._clear();});}},0);this.$search.find('input').focus().on('keyup',function(e){self._findExisting($(this).val());});this.$ul.on('click','li:not(:first) a',function(e){self._selectRecord($(e.currentTarget));});return this._super.apply(this,arguments);},onFocus:function(){this.$target.attr('contentEditable','false');this._clear();},_clear:function(){var self=this;this.$search.siblings().remove();self.$search.find('input').val('');setTimeout(function(){self.$search.find('input').focus();},0);},_findExisting:function(name){var self=this;var domain=[];if(!name||!name.length){self.$search.siblings().remove();return;}
if(isNaN(+name)){if(this.Model!=='res.partner'){domain.push(['name','ilike',name]);}else{domain.push('|',['name','ilike',name],['email','ilike',name]);}}else{domain.push(['id','=',name]);}
return this._rpc({model:this.Model,method:'search_read',args:[domain,this.Model==='res.partner'?['name','display_name','city','country_id']:['name','display_name']],kwargs:{order:[{name:'name',asc:false}],limit:5,},}).then(function(result){self.$search.siblings().remove();self.$search.after(qweb.render('web_editor.many2one.search',{contacts:result}));});},_selectRecord:function($li){var self=this;this.ID=+$li.data('id');this.$target.attr('data-oe-many2one-id',this.ID).data('oe-many2one-id',this.ID);this.trigger_up('request_history_undo_record',{$target:this.$target});this.$target.trigger('content_changed');if(self.$target.data('oe-type')==='contact'){$('[data-oe-contact-options]').filter('[data-oe-model="'+self.$target.data('oe-model')+'"]').filter('[data-oe-id="'+self.$target.data('oe-id')+'"]').filter('[data-oe-field="'+self.$target.data('oe-field')+'"]').filter('[data-oe-contact-options!="'+self.$target.data('oe-contact-options')+'"]').add(self.$target).attr('data-oe-many2one-id',self.ID).data('oe-many2one-id',self.ID).each(function(){var $node=$(this);var options=$node.data('oe-contact-options');self._rpc({model:'ir.qweb.field.contact',method:'get_record_to_html',args:[[self.ID]],kwargs:{options:options,},}).then(function(html){$node.html(html);});});}else{self.$target.text($li.data('name'));}
_.defer(function(){self.trigger_up('deactivate_snippet');});}});return{Class:SnippetOption,registry:registry,};});;

/* /web_editor/static/src/js/editor/transcoder.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.transcoder',function(require){'use strict';var base=require('web_editor.base');var rulesCache=[];function getMatchedCSSRules(a){var i,r,k;if(!rulesCache.length){var sheets=document.styleSheets;for(i=sheets.length-1;i>=0;i--){var rules;try{rules=sheets[i].rules||sheets[i].cssRules;}catch(e){console.warn("Can't read the css rules of: "+sheets[i].href,e);continue;}
if(rules){for(r=rules.length-1;r>=0;r--){var selectorText=rules[r].selectorText;if(selectorText&&rules[r].cssText&&selectorText!=='*'&&selectorText.indexOf(':hover')===-1&&selectorText.indexOf(':before')===-1&&selectorText.indexOf(':after')===-1&&selectorText.indexOf(':active')===-1&&selectorText.indexOf(':link')===-1&&selectorText.indexOf('::')===-1&&selectorText.indexOf("'")===-1){var st=selectorText.split(/\s*,\s*/);for(k=0;k<st.length;k++){rulesCache.push({'selector':st[k],'style':rules[r].style});}}}}}
rulesCache.reverse();}
var css=[];var style;a.matches=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;for(r=0;r<rulesCache.length;r++){if(a.matches(rulesCache[r].selector)){style=rulesCache[r].style;if(style.parentRule){var style_obj={};var len;for(k=0,len=style.length;k<len;k++){if(style[k].indexOf('animation')!==-1){continue;}
style_obj[style[k]]=style[style[k].replace(/-(.)/g,function(a,b){return b.toUpperCase();})];if(new RegExp(style[k]+'\s*:[^:;]+!important').test(style.cssText)){style_obj[style[k]]+=' !important';}}
rulesCache[r].style=style=style_obj;}
css.push([rulesCache[r].selector,style]);}}
function specificity(selector){var a=0;selector=selector.replace(/#[a-z0-9_-]+/gi,function(){a++;return'';});var b=0;selector=selector.replace(/(\.[a-z0-9_-]+)|(\[.*?\])/gi,function(){b++;return'';});var c=0;selector=selector.replace(/(^|\s+|:+)[a-z0-9_-]+/gi,function(a){if(a.indexOf(':not(')===-1)c++;return'';});return a*100+b*10+c;}
css.sort(function(a,b){return specificity(a[0])-specificity(b[0]);});style={};_.each(css,function(v,k){_.each(v[1],function(v,k){if(v&&_.isString(v)&&k.indexOf('-webkit')===-1&&(!style[k]||style[k].indexOf('important')===-1||v.indexOf('important')!==-1)){style[k]=v;}});});_.each(style,function(v,k){if(v.indexOf('important')!==-1){style[k]=v.slice(0,v.length-11);}});if(style.display==='block'){delete style.display;}
_.each([{property:'margin'},{property:'padding'},{property:'border',propertyEnd:'-style',defaultValue:'none'},],function(propertyInfo){var p=propertyInfo.property;var e=propertyInfo.propertyEnd||'';var defVal=propertyInfo.defaultValue||0;if(style[p+'-top'+e]||style[p+'-right'+e]||style[p+'-bottom'+e]||style[p+'-left'+e]){if(style[p+'-top'+e]===style[p+'-right'+e]&&style[p+'-top'+e]===style[p+'-bottom'+e]&&style[p+'-top'+e]===style[p+'-left'+e]){style[p+e]=style[p+'-top'+e];}
else{style[p+e]=(style[p+'-top'+e]||defVal)+' '+(style[p+'-right'+e]||defVal)+' '+(style[p+'-bottom'+e]||defVal)+' '+(style[p+'-left'+e]||defVal);if(style[p+e].indexOf('inherit')!==-1||style[p+e].indexOf('initial')!==-1){delete style[p+e];return;}}
delete style[p+'-top'+e];delete style[p+'-right'+e];delete style[p+'-bottom'+e];delete style[p+'-left'+e];}});if(style['border-bottom-left-radius']){style['border-radius']=style['border-bottom-left-radius'];delete style['border-bottom-left-radius'];delete style['border-bottom-right-radius'];delete style['border-top-left-radius'];delete style['border-top-right-radius'];}
_.each(_.keys(style),function(k){if(k.indexOf('border')!==-1&&style[k]==='initial'){delete style[k];}});if(style['text-decoration-line']){style['text-decoration']=style['text-decoration-line'];delete style['text-decoration-line'];delete style['text-decoration-color'];delete style['text-decoration-style'];delete style['text-decoration-thickness'];}
if(style['text-align']==='inherit'){var $el=$(a).parent();do{var align=$el.css('text-align');if(_.indexOf(['left','right','center','justify'],align)>=0){style['text-align']=align;break;}
$el=$el.parent();}while($el.length&&!$el.is('html'));}
return style;}
function fontToImg($editable){$editable.find('.fa').each(function(){var $font=$(this);var icon,content;_.find(base.fontIcons,function(font){return _.find(base.getCssSelectors(font.parser),function(data){if($font.is(data.selector.replace(/::?before/g,''))){icon=data.names[0].split('-').shift();content=data.css.match(/content:\s*['"]?(.)['"]?/)[1];return true;}});});if(content){var color=$font.css('color').replace(/\s/g,'');$font.replaceWith($('<img/>',{src:_.str.sprintf('/web_editor/font_to_img/%s/%s/%s',content.charCodeAt(0),window.encodeURI(color),Math.max(1,$font.height())),'data-class':$font.attr('class'),'data-style':$font.attr('style'),class:$font.attr('class').replace(new RegExp('(^|\\s+)'+icon+'(-[^\\s]+)?','gi'),''),style:$font.attr('style'),}).css({height:'auto',width:'auto'}));}else{$font.remove();}});}
function imgToFont($editable){$editable.find('img[src*="/web_editor/font_to_img/"]').each(function(){var $img=$(this);$img.replaceWith($('<span/>',{class:$img.data('class'),style:$img.data('style')}));});}
function applyOverDescendants(node,func){node=node.firstChild;while(node){if(node.nodeType===1){func(node);applyOverDescendants(node,func);}
var $node=$(node);if(node.nodeName==='A'&&$node.hasClass('btn')&&!$node.children().length&&$(node).parents('.o_outlook_hack').length){node=$(node).parents('.o_outlook_hack')[0];}
else if(node.nodeName==='IMG'&&$node.parent('p').hasClass('o_outlook_hack')){node=$node.parent()[0];}
node=node.nextSibling;}}
function classToStyle($editable){if(!rulesCache.length){getMatchedCSSRules($editable[0]);}
applyOverDescendants($editable[0],function(node){var $target=$(node);var css=getMatchedCSSRules(node);var style=$target.attr('style')||'';_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+':'+v+';'+style;}});if(_.isEmpty(style)){$target.removeAttr('style');}else{$target.attr('style',style);}
if(node.nodeName==='TD'&&!node.childNodes.length){node.innerHTML='&nbsp;';}
if(node.nodeName==='A'&&$target.hasClass('btn')&&!$target.hasClass('btn-link')&&!$target.children().length){var $hack=$('<table class="o_outlook_hack" style="display: inline-table;vertical-align:middle"><tr><td></td></tr></table>');$hack.find('td').attr('height',$target.outerHeight()).css({'text-align':$target.parent().css('text-align'),'margin':$target.css('padding'),'border-radius':$target.css('border-radius'),'background-color':$target.css('background-color'),});$target.after($hack);$target.appendTo($hack.find('td'));node=$hack[0].previousSibling;if(node&&node.nodeType===Node.TEXT_NODE&&!node.textContent.match(/\S/)){$(node).remove();}
node=$hack[0].nextSibling;if(node&&node.nodeType===Node.TEXT_NODE&&!node.textContent.match(/\S/)){$(node).remove();}}
else if(node.nodeName==='IMG'&&$target.is('.mx-auto.d-block')){$target.wrap('<p class="o_outlook_hack" style="text-align:center;margin:0"/>');}});}
function styleToClass($editable){$editable.find('.o_outlook_hack').each(function(){$(this).after($('a,img',this));}).remove();getMatchedCSSRules($editable[0]);var $c=$('<span/>').appendTo(document.body);applyOverDescendants($editable[0],function(node){var $target=$(node);var css=getMatchedCSSRules(node);var style='';_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+':'+v+';'+style;}});css=($c.attr('style',style).attr('style')||'').split(/\s*;\s*/);style=$target.attr('style')||'';_.each(css,function(v){style=style.replace(v,'');});style=style.replace(/;+(\s;)*/g,';').replace(/^;/g,'');if(style!==''){$target.attr('style',style);}else{$target.removeAttr('style');}});$c.remove();}
function attachmentThumbnailToLinkImg($editable){$editable.find('a[href*="/web/content/"][data-mimetype]:empty').each(function(){var $link=$(this);var $img=$('<img/>').attr('src',$link.css('background-image').replace(/(^url\(['"])|(['"]\)$)/g,'')).css('height',Math.max(1,$link.height())+'px').css('width',Math.max(1,$link.width())+'px');$link.append($img);});}
function linkImgToAttachmentThumbnail($editable){$editable.find('a[href*="/web/content/"][data-mimetype] > img').remove();}
return{fontToImg:fontToImg,imgToFont:imgToFont,classToStyle:classToStyle,styleToClass:styleToClass,attachmentThumbnailToLinkImg:attachmentThumbnailToLinkImg,linkImgToAttachmentThumbnail:linkImgToAttachmentThumbnail,};});;

/* /web_editor/static/src/js/editor/translator.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.translate',function(require){'use strict';var core=require('web.core');var Dialog=require('web.Dialog');var localStorage=require('web.local_storage');var Widget=require('web.Widget');var weContext=require('web_editor.context');var rte=require('web_editor.rte');var weWidgets=require('web_editor.widget');var Dialog=require('web.Dialog');var _t=core._t;var localStorageNoDialogKey='website_translator_nodialog';var RTETranslatorWidget=rte.Class.extend({_saveElement:function($el,context,withLang){var self=this;if($el.data('oe-translation-id')){return this._rpc({model:'ir.translation',method:'save_html',args:[[+$el.data('oe-translation-id')],this._getEscapedElement($el).html()],context:context,}).fail(function(error){Dialog.alert(null,error.data.message);});}
return this._super($el,context,withLang===undefined?true:withLang);},});var AttributeTranslateDialog=weWidgets.Dialog.extend({init:function(parent,options,node){this._super(parent,_.extend({title:_t("Translate Attribute"),buttons:[{text:_t("Close"),classes:'btn-primary',click:this.save}],},options||{}));this.$target=$(node);this.translation=$(node).data('translation');},start:function(){var self=this;var $group=$('<div/>',{class:'form-group'}).appendTo(this.$el);_.each(this.translation,function(node,attr){var $node=$(node);var $label=$('<label class="col-form-label"></label>').text(attr);var $input=$('<input class="form-control"/>').val($node.html());$input.on('change keyup',function(){var value=$input.val();$node.html(value).trigger('change',node);$node.data('$node').attr($node.data('attribute'),value).trigger('translate');self.trigger_up('rte_change',{target:node});});$group.append($label).append($input);});return this._super.apply(this,arguments);}});var TranslatorInfoDialog=Dialog.extend({template:'web_editor.TranslatorInfoDialog',xmlDependencies:Dialog.prototype.xmlDependencies.concat(['/web_editor/static/src/xml/translator.xml']),init:function(parent,options){this._super(parent,_.extend({title:_t("Translation Info"),buttons:[{text:_t("Ok, never show me this again"),classes:'btn-primary',close:true,click:this._onStrongOk.bind(this)},{text:_t("Ok"),close:true}],},options||{}));},_onStrongOk:function(){localStorage.setItem(localStorageNoDialogKey,true);},});var TranslatorMenuBar=Widget.extend({template:'web_editor.editorbar',xmlDependencies:['/web_editor/static/src/xml/editor.xml'],events:{'click [data-action="save"]':'_onSaveClick','click [data-action="cancel"]':'_onCancelClick',},custom_events:{'rte_change':'_onRTEChange',},init:function(parent,$target,lang){this._super.apply(this,arguments);var $edit=$target.find('[data-oe-translation-id], [data-oe-model][data-oe-id][data-oe-field]');$edit.filter(':has([data-oe-translation-id], [data-oe-model][data-oe-id][data-oe-field])').attr('data-oe-readonly',true);this.$target=$edit.not('[data-oe-readonly]');var attrs=['placeholder','title','alt'];_.each(attrs,function(attr){$target.find('['+attr+'*="data-oe-translation-id="]').filter(':empty, input, select, textarea, img').each(function(){var $node=$(this);var translation=$node.data('translation')||{};var trans=$node.attr(attr);var match=trans.match(/<span [^>]*data-oe-translation-id="([0-9]+)"[^>]*>(.*)<\/span>/);var $trans=$(trans).addClass('d-none o_editable o_editable_translatable_attribute').appendTo('body');$trans.data('$node',$node).data('attribute',attr);translation[attr]=$trans[0];$node.attr(attr,match[2]);var select2=$node.data('select2');if(select2){select2.blur();$node.on('translate',function(){select2.blur();});$node=select2.container.find('input');}
$node.addClass('o_translatable_attribute').data('translation',translation);});});this.$target_attr=$target.find('.o_translatable_attribute');this.$target_attribute=$('.o_editable_translatable_attribute');this.lang=lang||weContext.get().lang;this.rte=new RTETranslatorWidget(this,this._getRTEConfig);},start:function(){this.$('#web_editor-toolbars').remove();var flag=false;window.onbeforeunload=function(event){if($('.o_editable.o_dirty').length&&!flag){flag=true;setTimeout(function(){flag=false;},0);return _t('This document is not saved!');}};this.$target.addClass('o_editable');this.rte.start();this.translations=[];this._markTranslatableNodes();this.$el.show();this.trigger('edit');if(!localStorage.getItem(localStorageNoDialogKey)){new TranslatorInfoDialog(this).open();}
return this._super.apply(this,arguments);},destroy:function(){this._cancel();this._super.apply(this,arguments);},_cancel:function(){var self=this;this.rte.cancel();this.$target.each(function(){$(this).html(self._getTranlationObject(this).value);});this._unmarkTranslatableNode();this.trigger('cancel');this.$el.hide();window.onbeforeunload=null;},_getRTEConfig:function($editable){return{airMode:true,focus:false,airPopover:$editable.data('oe-model')?[['history',['undo','redo']],]:[['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['history',['undo','redo']],],styleWithSpan:false,inlinemedia:['p'],lang:'odoo',onChange:function(html,$editable){$editable.trigger('content_changed');},};},_getTranlationObject:function(node){var $node=$(node);var id=+$node.data('oe-translation-id');if(!id){id=$node.data('oe-model')+','+$node.data('oe-id')+','+$node.data('oe-field');}
var trans=_.find(this.translations,function(trans){return trans.id===id;});if(!trans){this.translations.push(trans={'id':id});}
return trans;},_markTranslatableNodes:function(){var self=this;this.$target.add(this.$target_attribute).each(function(){var $node=$(this);var trans=self._getTranlationObject(this);trans.value=(trans.value?trans.value:$node.html()).replace(/[ \t\n\r]+/,' ');});this.$target.parent().prependEvent('click.translator',function(ev){if(ev.ctrlKey||!$(ev.target).is(':o_editable')){return;}
ev.preventDefault();ev.stopPropagation();});this.$target_attr.each(function(){var $node=$(this);var translation=$node.data('translation');_.each(translation,function(node,attr){var trans=self._getTranlationObject(node);trans.value=(trans.value?trans.value:$node.html()).replace(/[ \t\n\r]+/,' ');$node.attr('data-oe-translation-state',(trans.state||'to_translate'));});});this.$target_attr.prependEvent('mousedown.translator click.translator mouseup.translator',function(ev){if(ev.ctrlKey){return;}
ev.preventDefault();ev.stopPropagation();if(ev.type!=='mousedown'){return;}
new AttributeTranslateDialog(self,{},ev.target).open();});},_save:function(){return this.rte.save(weContext.get({lang:this.lang})).then(function(){window.location.href=window.location.href.replace(/&?edit_translations(=[^&]*)?/g,'');return $.Deferred();});},_unmarkTranslatableNode:function(){this.$target.removeClass('o_editable').removeAttr('contentEditable');this.$target.parent().off('.translator');this.$target_attr.off('.translator');},_onCancelClick:function(){this._cancel();},_onRTEChange:function(ev){var $node=$(ev.data.target);$node.find('p,div').each(function(){var $p=$(this);$p.after($p.html()).remove();});var trans=this._getTranlationObject($node[0]);$node.toggleClass('o_dirty',trans.value!==$node.html().replace(/[ \t\n\r]+/,' '));},_onSaveClick:function(){this._save();},});return{Class:TranslatorMenuBar,};});;

/* /web_editor/static/src/js/tours/rte.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.tour',function(require){'use strict';var core=require('web.core');var tour=require('web_tour.tour');var base=require('web_editor.base');function simulateClickEvent(el,type){var evt=document.createEvent('MouseEvents');evt.initMouseEvent(type,true,true,window,0,0,0,0,0,false,false,false,false,0,el);el.dispatchEvent(evt);}
tour.register('rte',{url:'/web_editor/field/html?callback=FieldTextHtml_0&enable_editor=1&datarecord=%7B%7D',test:true,wait_for:base.ready(),},[{content:"Change html for this test",trigger:"#editable_area",run:function(){var html='\n'+'<section>\n'+'    <div class="container" style="width: 600px;">\n'+'        <div class="row">\n'+'            <div class="col-lg-6 mt16">\n'+'<h1 id="text_content_id">Batnae municipium in Anthemusia</h1>     \n'+'     <p>Batnae municipium in Anthemusia conditum Macedonum manu priscorum ab Euphrate flumine brevi spatio disparatur, refertum mercatoribus opulentis, ubi annua sollemnitate prope Septembris initium mensis ad.</p>\n'+'     <p>    Quam <img style="width: 25%" src="/web/static/src/img/logo.png"/> quidem <span class="fa fa-flag fa-2x"></span> partem accusationis admiratus sum et moleste tuli potissimum esse Atratino datam. Neque enim decebat neque aetas.</p>\n'+'     <p>Et hanc quidem praeter oppida multa duae civitates exornant Seleucia opus Seleuci regis, et Claudiopolis quam deduxit coloniam Claudius Caesar. Isaura enim antehac nimium potens, olim subversa ut rebellatrix.</p>'+'<p>Harum trium sententiarum nulli prorsus assentior.</p>\n'+'        </div>\n'+'        <div class="col-lg-6 mt16">\n'+'            <img class="img img-fluid shadow mb16" src="/web/static/src/img/logo.png" alt="Odoo text and image block">\n'+'        </div>\n'+'    </div>\n'+'</section>\n';this.$anchor.html(html);}},{content:"simulate triple click and change text bg-color",trigger:'#editable_area > section .row > div:first',run:function(){var $h1=$('h1',this.$anchor);$.summernote.core.range.create($h1[0].firstChild,0,$('p',this.$anchor)[0],0).select();simulateClickEvent($h1[0],'mouseup');}},{content:"change text bg-color after triple click",trigger:'.note-color button.dropdown-toggle:has(.fa-paint-brush)',extra_trigger:'#editable_area > section .row > div:first',},{content:"change text backColor",trigger:"button[data-event=backColor]:visible:eq(2)",},{content:"change selection to change text color",trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1 font',run:function(){$.summernote.core.range.create(this.$anchor[0].firstChild,5,this.$anchor[0].firstChild,10).select();simulateClickEvent(this.$anchor[0],'mouseup');}},{content:"open color dropdown",trigger:".note-color button.dropdown-toggle:has(.fa-font)",},{content:"change text color",trigger:"button[data-event=foreColor]:visible:first",},{content:"change selection to change text bg-color again",trigger:'#editable_area > section .row > div:first h1 font:eq(2)',run:function(){$.summernote.core.range.create(this.$anchor.prev()[0].firstChild,3,this.$anchor[0].firstChild,10).select();simulateClickEvent(this.$anchor.prev()[0],'mouseup');}},{content:"open color dropdown",trigger:".note-color button.dropdown-toggle:has(.fa-paint-brush)",},{content:"change text backColor again",trigger:"button[data-event=backColor]:visible:first",},{content:"change selection (h1 and p) to change text color with class",trigger:'#editable_area > section .row > div:first h1 font:eq(4)',run:function(){$.summernote.core.range.create(this.$anchor.prev()[0].firstChild,3,this.$anchor.parent("h1").next("p")[0].firstChild,30).select();simulateClickEvent(this.$anchor.prev()[0],'mouseup');}},{content:"open color dropdown",trigger:".note-color button.dropdown-toggle:has(.fa-font)",},{content:"change text color again",trigger:"button[data-event=foreColor]:visible:eq(3)",},{content:"delete selection",trigger:'.o_editable.note-editable.o_dirty',extra_trigger:'#editable_area > section .row > div:first p font',run:"keydown 46",},{content:"create an other selection to delete",trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1',extra_trigger:'.o_editable.note-editable.o_dirty',run:function(){$.summernote.core.range.createFromNode(this.$anchor.next("p")[0]).clean();$.summernote.core.range.create(this.$anchor.find('font:containsExact(ici)')[0].firstChild,1,this.$anchor.next().next()[0].firstChild,5).select();simulateClickEvent(this.$anchor.find('font:last')[0],'mouseup');},},{content:"clean and delete (backspace) an other selection",trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1',run:"keydown 8",},{content:"an other selection",trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) ) h1',extra_trigger:'.o_editable.note-editable.o_dirty',run:function(){$.summernote.core.range.create(this.$anchor.find('font:first')[0].firstChild,3,this.$anchor.next("p")[0].childNodes[2],8).select();simulateClickEvent(this.$anchor.find('font:first')[0],'mouseup');},},{content:"delete an other selection",trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) ) h1',run:"keydown 46",},{content:"undo",trigger:'.note-image-popover button[data-event="undo"]',extra_trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(Bat) )',},{content:"undo again",trigger:'.note-air-popover button[data-event="undo"]',extra_trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) )',},{content:"delete (backspace) after undo",trigger:'.o_editable.note-editable.o_dirty',extra_trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1',run:"keydown 8",},{content:"click on image",trigger:'#editable_area > section .row > div:first img[style*="25%"]',extra_trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) )',},{content:"Click on resize half",trigger:'.note-image-popover:visible button[data-event="resize"][data-value="0.5"]',},{content:"Click on edit picture",trigger:'.note-image-popover:visible button[data-event="showImageDialog"]',extra_trigger:'#editable_area > section .row > div:first img[style*="50%"]',},{content:"Click on pictogram tab",trigger:'a[data-toggle="tab"]:contains(Pictogram)',extra_trigger:'#editor-media-image',},{content:"select a pictogram",trigger:'#editor-media-icon.active span.fa:first',},{content:"save pictogram",trigger:'.modal-footer > .btn-primary',extra_trigger:'#editor-media-icon.active span.o_selected',},{content:"select a size for the pictogram",trigger:'.note-image-popover button[data-event="resizefa"][data-value="3"]',},{content:"click on float right",trigger:'.note-image-popover:visible button[data-event="floatMe"][data-value="right"]',extra_trigger:'#wrapwrap span.fa-3x',},{content:"click on create link",trigger:'.note-image-popover:visible button[data-event="showLinkDialog"]',extra_trigger:'#editable_area > section .row > div:first span.fa.float-right',},{content:"insert a link url",trigger:'input[name="url"]',run:"text http://www.odoo.com",},{content:"click on color style",trigger:'.o_link_dialog_color > .o_link_dialog_color_item.btn-success',extra_trigger:'a#link-preview:containsRegex(/^<span [^>]+><\\/span>$/) > span.fa.fa-3x.float-right',},{content:"save link",trigger:'.modal-footer > .btn-primary',extra_trigger:'a#link-preview.btn.btn-success span.fa.fa-3x.float-right',},{content:"click on other picture",trigger:'#editable_area > section .row > div:last img',extra_trigger:'body:not(:has(#link-preview)) a.btn[href^="http://"]:has(span.fa.fa-3x.float-right)',},{content:"click on create link again",trigger:'.note-image-popover:visible button[data-event="showLinkDialog"]',extra_trigger:'#editable_area > section .row > div:first span.fa.float-right',},{content:"insert an email",trigger:'input[name="url"]',run:"text test@test.test",},{content:"click on color style again",trigger:'.o_link_dialog_color > .o_link_dialog_color_item.btn-success',extra_trigger:'a#link-preview:containsRegex(/^<img [^>]+>$/) img',},{content:"save link",trigger:'.modal-footer > .btn-primary',extra_trigger:'a#link-preview.btn.btn-success[href="mailto:test@test.test"]:containsRegex(/^<img [^>]+>$/) img',},{content:"select for triple enter then double backspace",trigger:'#editable_area > section .row > div:first p:eq(2)',extra_trigger:'body:not(:has(#link-preview)) #editable_area > section .row > div:eq(1) > a > img',run:function(){var p=this.$anchor[0].firstChild;$.summernote.core.range.create(p,p.textContent.length,p,p.textContent.length).select();simulateClickEvent(p,'mouseup');},},{content:"triple enter then double backspace",trigger:'#editable_area > section .row > div:first p:eq(2)',run:"keydown 66,13,66,13,13,8,8",},{content:"add ul content",trigger:'#editable_area > section .row > div:first',extra_trigger:'body:not(:has(#editable_area > section .row > div:first p:eq(5), #editable_area > section .row > div:eq(3))) #editable_area > section .row > div:first p:eq(3)',run:function(){var html='  <ul>     '+'\n     <li>   <p>Batnae municipium.  </p></li>'+'\n     <li>    Seleucia praeter.</li>'+'\n     <li><p>Et hanc quidem.</p></li>'+'\n    </ul>';this.$anchor.append(html);var node=this.$anchor.find('ul li p:last')[0].firstChild;$.summernote.core.range.create(node,6).select();simulateClickEvent(node,'mouseup');}},{content:"click on style dropdown",trigger:'.note-air-popover .note-style button.dropdown-toggle',extra_trigger:'#editable_area > section .row > div:first ul li p:first',},{content:"select h3",trigger:'.note-air-popover .note-style ul:visible a[data-value="h3"]',},{content:"select h3",trigger:'#editable_area > section .row > div:first > ul > li > h3',run:function(){var node=this.$anchor[0].firstChild;$.summernote.core.range.create(node,0).select();simulateClickEvent(node,'mouseup');}},{content:"double tabulation",trigger:'#editable_area > section .row > div:first > ul > li > h3',run:"keydown 9,9",},{content:"click on order list",trigger:'.note-air-popover button[data-event="insertOrderedList"]',extra_trigger:'#editable_area > section .row > div:first ul > li > ul > li > ul > li > h3',},{content:"select for enter in ul",trigger:'#editable_area > section .row > div:first ul li > p:last',run:function(){this.$anchor[0].firstChild.textContent+="";$.summernote.core.range.create(this.$anchor[0].firstChild,7).select();simulateClickEvent(this.$anchor[0],'mouseup');}},{content:"enter in ul",trigger:'#editable_area > section .row > div:first ul li > p:last',run:"keydown 66,13",},{trigger:'#editable_area > section .row > div:first ul li > p:eq(1):containsRegex(/^municipium./)',content:"backspace in list",run:"keydown 8",},{content:"end",trigger:'#editable_area > section .row > div:first ul li p:eq(0):containsRegex(/^Batnae Bmunicipium.$/)',}]);tour.register('rte_inline',{url:'/web_editor/field/html/inline?callback=FieldTextHtml_0&enable_editor=1&datarecord=%7B%7D',test:true,wait_for:base.ready(),},[{content:"Change html for this test",trigger:"#editable_area",run:function(){var html='\n'+'<div>\n'+'  <table cellspacing="0" cellpadding="0" width="100%">\n'+'    <tbody>\n'+'      <tr>\n'+'        <td valign="center" width="270">\n'+'          <img src="/logo.png" alt="Your Logo" class="rounded-circle img-thumbnail">\n'+'        </td>\n'+'        <td valign="center" width="270">\n'+'          <a href="https://www.facebook.com/Odoo"><span class="fa fa-facebook-square fa-2x text-primary"></span></a>\n'+'          <span style="color: rgb(255, 0, 0);" class="fa fa-4x fa-google-plus-square float-right"></span>\n'+'        </td>\n'+'      </tr>\n'+'    </tbody>\n'+'  </table>\n'+'</div>';this.$anchor.html(html);}},{content:"call clean for save",trigger:'#wrapwrap table',run:function(){core.bus.trigger('snippet_editor_clean_for_save');}},{content:"check the image style",trigger:'#wrapwrap img:first[width][height][style*="-radius"][style*="1px"][style*="padding"]',},{content:"check the font image src",trigger:'#wrapwrap img:eq(1)[src^="/web_editor/font_to_img/"][src$="/rgb(0,160,157)/28"]',},{content:"check the font class to css",trigger:'#wrapwrap img:eq(1)[height]:not([class*="fa"])',},{content:"check the second font class to css",trigger:'#wrapwrap img:eq(2)[style*="float: right"],#wrapwrap img:eq(2)[style*="float:right"]',}]);});;

/* /web_editor/static/src/js/widgets/widgets.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.widget',function(require){'use strict';var ajax=require('web.ajax');var base=require('web_editor.base');var core=require('web.core');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var weContext=require("web_editor.context");var QWeb=core.qweb;var range=$.summernote.core.range;var dom=$.summernote.core.dom;var _t=core._t;function simulateMouseEvent(el,type){var evt=document.createEvent("MouseEvents");evt.initMouseEvent(type,true,true,window,0,0,0,0,0,false,false,false,false,0,el);el.dispatchEvent(evt);}
Dialog=Dialog.extend({init:function(parent,options){options=options||{};this._super(parent,_.extend({},{buttons:[{text:options.save_text||_t("Save"),classes:'btn-primary',click:this.save},{text:_t("Discard"),close:true}]},options));this.destroyAction='cancel';var self=this;this.opened().then(function(){self.$('input:first').focus();});this.on('closed',this,function(){this.trigger(this.destroyAction,this.final_data||null);});},save:function(){this.destroyAction="save";this.close();},});var AltDialog=Dialog.extend({template:'web_editor.dialog.alt',xmlDependencies:Dialog.prototype.xmlDependencies.concat(['/web_editor/static/src/xml/editor.xml']),init:function(parent,options,$editable,media){this._super(parent,_.extend({},{title:_t("Change media description and tooltip")},options));this.$editable=$editable;this.media=media;this.alt=($(this.media).attr('alt')||"").replace(/&quot;/g,'"');this.tag_title=($(this.media).attr('title')||"").replace(/&quot;/g,'"');},save:function(){var self=this;range.createFromNode(this.media).select();this.$editable.data('NoteHistory').recordUndo();var alt=this.$('#alt').val();var title=this.$('#title').val();$(this.media).attr('alt',alt?alt.replace(/"/g,"&quot;"):null).attr('title',title?title.replace(/"/g,"&quot;"):null);_.defer(function(){simulateMouseEvent(self.media,'mouseup');});return this._super.apply(this,arguments);},});var MediaWidget=Widget.extend({xmlDependencies:['/web_editor/static/src/xml/editor.xml'],init:function(parent,media,options){this._super.apply(this,arguments);this.media=media;this.$media=$(media);this.page=0;this.lastLoadedPage=-1;this.records=[];this.needle='';},clear:function(){if(!this.media){return;}
this._clear();},getControlPanelConfig:function(){return{searchEnabled:true,pagerEnabled:true,pagerLeftEnabled:false,pagerRightEnabled:false,};},goToPage:function(page){this.page=page;if(page>this.lastLoadedPage){return this.fetchPage(page);}
return $.when();},fetchPage:function(){return $.when();},search:function(needle){},save:function(){},_clear:function(){},_replaceMedia:function($media){this.$media.replaceWith($media);this.$media=$media;this.media=$media[0];},});var ImageWidget=MediaWidget.extend({template:'web_editor.dialog.image',events:{'click .o_upload_image_button':'_onUploadButtonClick','click .o_upload_image_button_no_optimization':'_onUploadButtonNoOptimizationClick','change input[type=file]':'_onImageSelection','click .o_upload_image_url_button':'_onUploadURLButtonClick','input input.url':"_onSearchInput",'click .existing-attachments [data-src]':'_onImageClick','dblclick .existing-attachments [data-src]':'_onImageDblClick','click .o_existing_attachment_remove':'_onRemoveClick',},IMAGES_PER_ROW:6,IMAGES_ROWS:2,init:function(parent,media,options){this._super.apply(this,arguments);this.IMAGES_PER_PAGE=this.IMAGES_PER_ROW*this.IMAGES_ROWS;this.options=options;this.accept=options.accept||(options.document?'*/*':'image/*');if(options.domain){this.domain=typeof options.domain==='function'?options.domain():options.domain;}else if(options.res_id){this.domain=['|','&',['res_model','=',options.res_model],['res_id','=',options.res_id],['res_model','=','ir.ui.view']];}else{this.domain=[['res_model','=','ir.ui.view']];}
this.multiImages=options.multiImages;this.firstFilters=options.firstFilters||[];this.lastFilters=options.lastFilters||[];this.images=[];},start:function(){var def=this._super.apply(this,arguments);var self=this;var o={url:null,alt:null,};if(this.$media.is('img')){o.url=this.$media.attr('src');}else if(this.$media.is('a.o_image')){o.url=this.$media.attr('href').replace(/[?].*/,'');o.id=+o.url.match(/\/web\/content\/(\d+)/,'')[1];o.isDocument=true;}
return this.search('').then(function(){if(o.url){self._toggleImage(_.find(self.records,function(record){return record.url===o.url;})||o);}
return def;});},getControlPanelConfig:function(){return _.extend(this._super.apply(this,arguments),{pagerLeftEnabled:this.page>0,pagerRightEnabled:(this.page+1)*this.IMAGES_PER_PAGE<this.records.length,});},goToPage:function(page){var self=this;return this._super.apply(this,arguments).then(function(){self._renderImages();});},save:function(){var self=this;if(this.multiImages){return this.images;}
var img=this.images[0];if(!img){return this.media;}
var def=$.when();if(!img.access_token){def=this._rpc({model:'ir.attachment',method:'generate_access_token',args:[[img.id]]}).then(function(access_token){img.access_token=access_token[0];});}
return def.then(function(){if(!img.isDocument){if(img.access_token&&self.options.res_model!=='ir.ui.view'){img.src+=_.str.sprintf('?access_token=%s',img.access_token);}
if(!self.$media.is('img')){self._replaceMedia($('<img/>',{class:'img-fluid o_we_custom_image'}));}
self.$media.attr('src',img.src);}else{if(!self.$media.is('a')){$('.note-control-selection').hide();self._replaceMedia($('<a/>'));}
var href='/web/content/'+img.id+'?';if(img.access_token&&self.options.res_model!=='ir.ui.view'){href+=_.str.sprintf('access_token=%s&',img.access_token);}
href+='unique='+img.checksum+'&download=true';self.$media.attr('href',href);self.$media.addClass('o_image').attr('title',img.name).attr('data-mimetype',img.mimetype);}
self.$media.attr('alt',img.alt);var style=self.style;if(style){self.$media.css(style);}
if(self.options.onUpload){self.options.onUpload([img]);}
if(self.$media.attr('data-aspect-ratio')){var attrs=['aspect-ratio','x','y','width','height','rotate','scale-x','scale-y'];Object.keys(self.$media.data()).forEach(function(key){if(_.str.startsWith(key,'crop:')){attrs.push(key);}});self.$media.removeClass('o_cropped_img_to_save');_.each(attrs,function(attr){self.$media.removeData(attr);self.$media.removeAttr('data-'+attr);});}
return self.media;});},search:function(needle){var self=this;this.records.splice(0);this.lastLoadedPage=-1;this.needle=needle;return this.goToPage(0).then(function(){self._renderImages();});},fetchPage:function(pageNum){var domain=this.domain.concat(['|',['type','=like','binary'],['url','!=',false],'|',['mimetype','=',false],['mimetype',this.options.document?'not in':'in',['image/gif','image/jpe','image/jpeg','image/jpg','image/gif','image/png']],]);if(this.needle&&this.needle.length){domain.push('|',['datas_fname','ilike',this.needle],['name','ilike',this.needle]);}
domain.push('|',['datas_fname','=',false],'!',['datas_fname','=like','%.crop'],'!',['name','=like','%.crop']);var self=this;return this._rpc({model:'ir.attachment',method:'search_read',args:[],kwargs:{domain:domain,fields:['name','datas_fname','mimetype','checksum','url','type','res_id','res_model','access_token'],order:[{name:'id',asc:false}],context:weContext.get(),limit:this.IMAGES_PER_PAGE+1,offset:pageNum*this.IMAGES_PER_PAGE,}}).then(function(records){self.lastLoadedPage=pageNum;self.records=self.records.slice();Array.prototype.splice.apply(self.records,[pageNum*self.IMAGES_PER_PAGE,records.length].concat(records));_.each(self.records,function(record){record.src=record.url||_.str.sprintf('/web/image/%s/%s',record.id,encodeURI(record.name));record.isDocument=!(/gif|jpe|jpg|png/.test(record.mimetype));});});},_clear:function(){this.media.className=this.media.className.replace(/(^|\s+)((img(\s|$)|img-(?!circle|rounded|thumbnail))[^\s]*)/g,' ');},_highlightSelectedImages:function(){var self=this;this.$('.o_existing_attachment_cell.o_selected').removeClass("o_selected");var $select=this.$('.o_existing_attachment_cell [data-src]').filter(function(){var $img=$(this);return!!_.find(self.images,function(v){return(v.url===$img.data("src")||($img.data("url")&&v.url===$img.data("url"))||v.id===$img.data("id"));});});$select.closest('.o_existing_attachment_cell').addClass("o_selected");return $select;},_renderImages:function(){var self=this;var startIndex=this.page*this.IMAGES_PER_PAGE;var rows=_(this.records).chain().slice(startIndex,startIndex+this.IMAGES_PER_PAGE).groupBy(function(a,index){return Math.floor(index/self.IMAGES_PER_ROW);}).values().value();this.$('.form-text').empty();this.$('.existing-attachments').replaceWith(QWeb.render('web_editor.dialog.image.existing.content',{rows:rows}));var $divs=this.$('.o_image');var imageDefs=_.map($divs,function(el){var $div=$(el);if(/gif|jpe|jpg|png/.test($div.data('mimetype'))){var $img=$('<img/>',{class:'img-fluid',src:$div.data('url')||$div.data('src'),});var def=$.Deferred();$img[0].onload=def.resolve.bind(def);$div.addClass('o_webimage').append($img);return def;}});$.when.apply($,imageDefs).then(function(){_.delay(function(){$divs.removeClass('o_image_loading');},400);});this._highlightSelectedImages();},_toggleImage:function(attachment,clearSearch,force_select){if(this.multiImages){var img=_.select(this.images,function(v){return v.id===attachment.id;});if(img.length){if(!force_select){this.images.splice(this.images.indexOf(img[0]),1);}}else{this.images.push(attachment);}}else{this.images=[attachment];}
this._highlightSelectedImages();if(clearSearch){this.search('');}},_uploadImage:function(){var self=this;var $iframe=this.$('iframe');$iframe.on('load',function(){var iWindow=$iframe[0].contentWindow;var attachments=iWindow.attachments;var error=iWindow.error;self.$('.well > span').remove();self.$('.well > div').show();_.each(attachments,function(record){record.src=record.url||_.str.sprintf('/web/image/%s/%s',record.id,encodeURI(record.name));record.isDocument=!(/gif|jpe|jpg|png/.test(record.mimetype));});if(error||!attachments.length){_processFile(null,error||!attachments.length);}
self.images=attachments;for(var i=0;i<attachments.length;i++){_processFile(attachments[i],error);}
if(self.options.onUpload){self.options.onUpload(attachments);}
function _processFile(attachment,error){var $button=self.$('.o_upload_image_button');if(!error){$button.addClass('btn-success');self._toggleImage(attachment,true);}else{$button.addClass('btn-danger');self.$el.addClass('o_has_error').find('.form-control, .custom-select').addClass('is-invalid');self.$el.find('.form-text').text(error);}
if(!self.multiImages){self.trigger_up('save_request');}}});this.$el.submit();},_onImageClick:function(ev,force_select){var $img=$(ev.currentTarget);var attachment=_.find(this.records,function(record){return record.id===$img.data('id');});this._toggleImage(attachment,false,force_select);},_onImageDblClick:function(ev){this._onImageClick(ev,true);this.trigger_up('save_request');},_onImageSelection:function(){var $form=this.$('form');this.$el.addClass('nosave');$form.removeClass('o_has_error').find('.form-control, .custom-select').removeClass('is-invalid');$form.find('.form-text').empty();this.$('.o_upload_image_button').removeClass('btn-danger btn-success');this._uploadImage();},_onRemoveClick:function(ev){var self=this;var $helpBlock=this.$('.form-text').empty();var $a=$(ev.currentTarget);var id=parseInt($a.data('id'),10);var attachment=_.findWhere(this.records,{id:id});return this._rpc({route:'/web_editor/attachment/remove',params:{ids:[id],},}).then(function(prevented){if(_.isEmpty(prevented)){self.records=_.without(self.records,attachment);self._renderImages();return;}
$helpBlock.replaceWith(QWeb.render('web_editor.dialog.image.existing.error',{views:prevented[id]}));});},_onSearchInput:function(ev){var $input=$(ev.currentTarget);var $button=$input.next('.input-group-append').children();var emptyValue=($input.val()==='');$button.toggleClass('btn-secondary',emptyValue).toggleClass('btn-primary',!emptyValue).prop('disabled',emptyValue);},_onUploadButtonClick:function(){this.$('input[type=file]').click();},_onUploadButtonNoOptimizationClick:function(){this.$('input[name="disable_optimization"]').val('1');this.$('.o_upload_image_button').click();},_onUploadURLButtonClick:function(){this._uploadImage();},});var IconWidget=MediaWidget.extend({template:'web_editor.dialog.font-icons',events:{'click .font-icons-icon':'_onIconClick','dblclick .font-icons-icon':'_onIconDblClick',},init:function(parent,media){this._super.apply(this,arguments);base.computeFonts();this.iconsParser=base.fontIcons;this.alias=_.flatten(_.map(this.iconsParser,function(data){return data.alias;}));},start:function(){this.$icons=this.$('.font-icons-icon');var classes=(this.media&&this.media.className||'').split(/\s+/);for(var i=0;i<classes.length;i++){var cls=classes[i];if(_.contains(this.alias,cls)){this.selectedIcon=cls;this._highlightSelectedIcon();}}
this.nonIconClasses=_.without(classes,this.selectedIcon);return this._super.apply(this,arguments);},getControlPanelConfig:function(){return _.extend(this._super.apply(this,arguments),{pagerEnabled:false,});},save:function(){var style=this.$media.attr('style')||'';var iconFont=this._getFont(this.selectedIcon)||{base:'fa',font:''};var finalClasses=_.uniq(this.nonIconClasses.concat([iconFont.base,iconFont.font]));if(!this.$media.is('span')){var $span=$('<span/>');$span.data(this.$media.data());this._replaceMedia($span);style=style.replace(/\s*width:[^;]+/,'');}
this.$media.attr({class:_.compact(finalClasses).join(' '),style:style,});return this.media;},search:function(needle){var iconsParser=this.iconsParser;if(needle&&needle.length){iconsParser=[];_.filter(this.iconsParser,function(data){var cssData=_.filter(data.cssData,function(cssData){return _.find(cssData.names,function(alias){return alias.indexOf(needle)>=0;});});if(cssData.length){iconsParser.push({base:data.base,cssData:cssData,});}});}
this.$('div.font-icons-icons').html(QWeb.render('web_editor.dialog.font-icons.icons',{iconsParser:iconsParser}));return $.when();},_clear:function(){this.media.className=this.media.className.replace(/(^|\s)(fa(\s|$)|fa-[^\s]*)/g,' ');},_getFont:function(classNames){if(!(classNames instanceof Array)){classNames=(classNames||"").split(/\s+/);}
var fontIcon,cssData;for(var k=0;k<this.iconsParser.length;k++){fontIcon=this.iconsParser[k];for(var s=0;s<fontIcon.cssData.length;s++){cssData=fontIcon.cssData[s];if(_.intersection(classNames,cssData.names).length){return{base:fontIcon.base,parser:fontIcon.parser,font:cssData.names[0],};}}}
return null;},_highlightSelectedIcon:function(){var self=this;this.$icons.removeClass('o_selected');this.$icons.filter(function(i,el){return _.contains($(el).data('alias').split(','),self.selectedIcon);}).addClass('o_selected');},_onIconClick:function(ev){ev.preventDefault();ev.stopPropagation();this.selectedIcon=$(ev.currentTarget).data('id');this._highlightSelectedIcon();},_onIconDblClick:function(){this.trigger_up('save_request');},});var VideoWidget=MediaWidget.extend({template:'web_editor.dialog.video',events:{'change .o_video_dialog_options input':'_onUpdateVideoOption','input textarea#o_video_text':'_onVideoCodeInput','change textarea#o_video_text':'_onVideoCodeChange',},init:function(parent,media){this._super.apply(this,arguments);this._onVideoCodeInput=_.debounce(this._onVideoCodeInput,1000);},start:function(){this.$content=this.$('.o_video_dialog_iframe');var $media=$(this.media);if($media.hasClass('media_iframe_video')){var src=$media.data('oe-expression')||$media.data('src')||'';this.$('textarea#o_video_text').val(src);this.$('input#o_video_autoplay').prop('checked',src.indexOf('autoplay=1')>=0);this.$('input#o_video_hide_controls').prop('checked',src.indexOf('controls=0')>=0);this.$('input#o_video_loop').prop('checked',src.indexOf('loop=1')>=0);this.$('input#o_video_hide_fullscreen').prop('checked',src.indexOf('fs=0')>=0);this.$('input#o_video_hide_yt_logo').prop('checked',src.indexOf('modestbranding=1')>=0);this.$('input#o_video_hide_dm_logo').prop('checked',src.indexOf('ui-logo=0')>=0);this.$('input#o_video_hide_dm_share').prop('checked',src.indexOf('sharing-enable=0')>=0);this._updateVideo();}
return this._super.apply(this,arguments);},getControlPanelConfig:function(){return _.extend(this._super.apply(this,arguments),{searchEnabled:false,pagerEnabled:false,});},save:function(){this._updateVideo();if(this.$('.o_video_dialog_iframe').is('iframe')){this._replaceMedia($('<div class="media_iframe_video" data-oe-expression="'+this.$content.attr('src')+'">'+'<div class="css_editable_mode_display">&nbsp;</div>'+'<div class="media_iframe_video_size" contenteditable="false">&nbsp;</div>'+'<iframe src="'+this.$content.attr('src')+'" frameborder="0" contenteditable="false" allowfullscreen="allowfullscreen"></iframe>'+'</div>'));}
return this.media;},_clear:function(){if(this.media.dataset.src){try{delete this.media.dataset.src;}catch(e){this.media.dataset.src=undefined;}}
this.media.className=this.media.className.replace(/(^|\s)media_iframe_video(\s|$)/g,' ');},_createVideoNode:function(url,options){options=options||{};var ytRegExp=/^(?:(?:https?:)?\/\/)?(?:www\.)?(?:youtu\.be\/|youtube(-nocookie)?\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((?:\w|-){11})(?:\S+)?$/;var ytMatch=url.match(ytRegExp);var insRegExp=/(.*)instagram.com\/p\/(.[a-zA-Z0-9]*)/;var insMatch=url.match(insRegExp);var vinRegExp=/\/\/vine.co\/v\/(.[a-zA-Z0-9]*)/;var vinMatch=url.match(vinRegExp);var vimRegExp=/\/\/(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/;var vimMatch=url.match(vimRegExp);var dmRegExp=/.+dailymotion.com\/(video|hub|embed)\/([^_?]+)[^#]*(#video=([^_&]+))?/;var dmMatch=url.match(dmRegExp);var ykuRegExp=/(.*).youku\.com\/(v_show\/id_|embed\/)(.+)/;var ykuMatch=url.match(ykuRegExp);var $video=$('<iframe>').width(1280).height(720).attr('frameborder',0).addClass('o_video_dialog_iframe');var videoType='yt';if(!/^(http:\/\/|https:\/\/|\/\/)[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/i.test(url)){return{errorCode:0};}
var autoplay=options.autoplay?'?autoplay=1&mute=1':'?autoplay=0';if(ytMatch&&ytMatch[2].length===11){$video.attr('src','//www.youtube'+(ytMatch[1]||'')+'.com/embed/'+ytMatch[2]+autoplay);}else if(insMatch&&insMatch[2].length){$video.attr('src','//www.instagram.com/p/'+insMatch[2]+'/embed/');videoType='ins';}else if(vinMatch&&vinMatch[0].length){$video.attr('src',vinMatch[0]+'/embed/simple');videoType='vin';}else if(vimMatch&&vimMatch[3].length){$video.attr('src','//player.vimeo.com/video/'+vimMatch[3]+autoplay.replace('mute','muted'));videoType='vim';}else if(dmMatch&&dmMatch[2].length){var just_id=dmMatch[2].replace('video/','');$video.attr('src','//www.dailymotion.com/embed/video/'+just_id+autoplay);videoType='dm';}else if(ykuMatch&&ykuMatch[3].length){var yku_id=ykuMatch[3].indexOf('.html?')>=0?ykuMatch[3].substring(0,ykuMatch[3].indexOf('.html?')):ykuMatch[3];$video.attr('src','//player.youku.com/embed/'+yku_id);videoType='yku';}else{return{errorCode:1};}
if(ytMatch){$video.attr('src',$video.attr('src')+'&rel=0');}
if(options.loop&&(ytMatch||vimMatch)){var videoSrc=_.str.sprintf('%s&loop=1',$video.attr('src'));$video.attr('src',ytMatch?_.str.sprintf('%s&playlist=%s',videoSrc,ytMatch[2]):videoSrc);}
if(options.hide_controls&&(ytMatch||dmMatch)){$video.attr('src',$video.attr('src')+'&controls=0');}
if(options.hide_fullscreen&&ytMatch){$video.attr('src',$video.attr('src')+'&fs=0');}
if(options.hide_yt_logo&&ytMatch){$video.attr('src',$video.attr('src')+'&modestbranding=1');}
if(options.hide_dm_logo&&dmMatch){$video.attr('src',$video.attr('src')+'&ui-logo=0');}
if(options.hide_dm_share&&dmMatch){$video.attr('src',$video.attr('src')+'&sharing-enable=0');}
return{$video:$video,type:videoType};},_updateVideo:function(){this.$content.empty();this.$('#o_video_form_group').removeClass('o_has_error o_has_success').find('.form-control, .custom-select').removeClass('is-invalid is-valid');this.$('.o_video_dialog_options li').addClass('d-none');var $textarea=this.$('textarea#o_video_text');var code=$textarea.val().trim();if(!code){return;}
var embedMatch=code.match(/(src|href)=["']?([^"']+)?/);if(embedMatch&&embedMatch[2].length>0&&embedMatch[2].indexOf('instagram')){embedMatch[1]=embedMatch[2];}
var url=embedMatch?embedMatch[1]:code;var query=this._createVideoNode(url,{autoplay:this.$('input#o_video_autoplay').is(':checked'),hide_controls:this.$('input#o_video_hide_controls').is(':checked'),loop:this.$('input#o_video_loop').is(':checked'),hide_fullscreen:this.$('input#o_video_hide_fullscreen').is(':checked'),hide_yt_logo:this.$('input#o_video_hide_yt_logo').is(':checked'),hide_dm_logo:this.$('input#o_video_hide_dm_logo').is(':checked'),hide_dm_share:this.$('input#o_video_hide_dm_share').is(':checked'),});var $opt_box=this.$('.o_video_dialog_options');this.$el.find('.o_video_dialog_preview_text, .media_iframe_video_size').add($opt_box).toggleClass('d-none',!query.$video);this.$el.find('#o_video_form_group').toggleClass('o_has_error',!query.$video).find('.form-control, .custom-select').toggleClass('is-invalid',!query.$video).end().toggleClass('o_has_success',!!query.$video).find('.form-control, .custom-select').toggleClass('is-valid',!!query.$video);$opt_box.find('li.o_'+query.type+'_option').removeClass('d-none');$opt_box.toggleClass('d-none',$opt_box.find('li:not(.d-none)').length===0);if(query.type==='yt'){this.$('input#o_video_hide_fullscreen, input#o_video_hide_yt_logo').closest('li').toggleClass('d-none',this.$('input#o_video_hide_controls').is(':checked'));}
var $content=query.$video;if(!$content){switch(query.errorCode){case 0:$content=$('<div/>',{class:'alert alert-danger o_video_dialog_iframe',text:_t("The provided url is not valid"),});break;case 1:$content=$('<div/>',{class:'alert alert-warning o_video_dialog_iframe',text:_t("The provided url does not reference any supported video"),});break;}}
this.$content.replaceWith($content);this.$content=$content;},_onUpdateVideoOption:function(){this._updateVideo();},_onVideoCodeChange:function(){this._updateVideo();},_onVideoCodeInput:function(){this._updateVideo();},});var MediaDialog=Dialog.extend({template:'web_editor.dialog.media',xmlDependencies:Dialog.prototype.xmlDependencies.concat(['/web_editor/static/src/xml/editor.xml']),events:_.extend({},Dialog.prototype.events,{'input input#icon-search':'_onSearchInput','shown.bs.tab a[data-toggle="tab"]':'_onTabChange','click .previous:not(.disabled), .next:not(.disabled)':'_onPagerClick',}),custom_events:_.extend({},Dialog.prototype.custom_events||{},{save_request:'_onSaveRequest',update_control_panel:'_updateControlPanel',}),init:function(parent,options,$editable,media){var self=this;this._super(parent,_.extend({},{title:_t("Select a Media"),},options));if($editable){this.$editable=$editable;this.rte=this.$editable.rte||this.$editable.data('rte');}
this.media=media;this.$media=$(media);this.range=range.create();this.multiImages=options.multiImages;var onlyImages=options.onlyImages||this.multiImages||(this.media&&(this.$media.parent().data('oeField')==='image'||this.$media.parent().data('oeType')==='image'));this.noImages=options.noImages;this.noDocuments=onlyImages||options.noDocuments;this.noIcons=onlyImages||options.noIcons;this.noVideos=onlyImages||options.noVideos;if(!this.noImages){this.imageDialog=new ImageWidget(this,this.media,options);}
if(!this.noDocuments){this.documentDialog=new ImageWidget(this,this.media,_.extend({},options,{document:true}));}
if(!this.noIcons){this.iconDialog=new IconWidget(this,this.media,options);}
if(!this.noVideos){this.videoDialog=new VideoWidget(this,this.media,options);}
this.opened(function(){var tabToShow='icon';if(!self.media||self.$media.is('img')){tabToShow='image';}else if(self.$media.is('a.o_image')){tabToShow='document';}else if(self.$media.hasClass('media_iframe_video')){tabToShow='video';}else if(self.$media.parent().hasClass('media_iframe_video')){self.$media=self.$media.parent();self.media=self.$media[0];tabToShow='video';}
self.$('[href="#editor-media-'+tabToShow+'"]').tab('show');});this._onSearchInput=_.debounce(this._onSearchInput,250);},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];this.$modal.addClass('note-image-dialog');this.$modal.find('.modal-dialog').addClass('o_select_media_dialog');if(this.imageDialog){defs.push(this.imageDialog.appendTo(this.$("#editor-media-image")));}
if(this.documentDialog){defs.push(this.documentDialog.appendTo(this.$("#editor-media-document")));}
if(this.iconDialog){defs.push(this.iconDialog.appendTo(this.$("#editor-media-icon")));}
if(this.videoDialog){defs.push(this.videoDialog.appendTo(this.$("#editor-media-video")));}
return $.when.apply($,defs).then(function(){self._setActive(self.imageDialog);});},save:function(){var self=this;var args=arguments;var _super=this._super;if(this.multiImages){return $.when(this.active.save()).then(function(data){self.final_data=data;return _super.apply(self,args);});}
if(this.rte){this.range.select();this.rte.historyRecordUndo(this.media);}
if(this.media){this.$media.html('');_.each(['imageDialog','documentDialog','iconDialog','videoDialog'],function(v){if(self[v]&&self.active._clear.toString()!==self[v]._clear.toString()){self[v].clear();}});}
return $.when(this.active.save()).then(function(media){if(!self.media&&media){self.range.insertNode(media,true);}
self.media=media;self.$media=$(media);self.final_data=self.media;$(self.final_data).trigger('input').trigger('save');$(document.body).trigger("media-saved",self.final_data);_.defer(function(){if(!self.media||!self.media.parentNode){return;}
range.createFromNode(self.media).select();simulateMouseEvent(self.media,'mousedown');simulateMouseEvent(self.media,'mouseup');});return _super.apply(self,args);});},_setActive:function(widget){var self=this;this.active=widget;this.active.goToPage(0).then(function(){self._updateControlPanel();});},_updateControlPanel:function(){var cpConfig=this.active.getControlPanelConfig();this.$('li.search').toggleClass('d-none',!cpConfig.searchEnabled);this.$('.previous, .next').toggleClass('d-none',!cpConfig.pagerEnabled);this.$('.previous').toggleClass("disabled",!cpConfig.pagerLeftEnabled);this.$('.next').toggleClass("disabled",!cpConfig.pagerRightEnabled);},_onPagerClick:function(ev){ev.preventDefault();var self=this;this.active.goToPage(this.active.page+($(ev.currentTarget).hasClass('previous')?-1:1)).then(function(){self._updateControlPanel();});},_onSaveRequest:function(ev){ev.stopPropagation();this.save();},_onSearchInput:function(ev){var self=this;this.active.search($(ev.currentTarget).val()||'').then(function(){self._updateControlPanel();});},_onTabChange:function(ev){var $target=$(ev.target);if($target.is('[href="#editor-media-image"]')){this._setActive(this.imageDialog);}else if($target.is('[href="#editor-media-document"]')){this._setActive(this.documentDialog);}else if($target.is('[href="#editor-media-icon"]')){this._setActive(this.active=this.iconDialog);}else if($target.is('[href="#editor-media-video"]')){this._setActive(this.active=this.videoDialog);}},});var LinkDialog=Dialog.extend({template:'web_editor.dialog.link',xmlDependencies:Dialog.prototype.xmlDependencies.concat(['/web_editor/static/src/xml/editor.xml']),events:_.extend({},Dialog.prototype.events||{},{'input':'_onAnyChange','change':'_onAnyChange','input input[name="url"]':'_onURLInput',}),init:function(parent,options,editable,linkInfo){this._super(parent,_.extend({title:_t("Link to"),},options||{}));this.editable=editable;this.data=linkInfo||{};this.data.className="";var r=this.data.range;this.needLabel=!r||(r.sc===r.ec&&r.so===r.eo);if(this.data.range){this.data.iniClassName=$(this.data.range.sc).filter("a").attr("class")||"";this.data.className=this.data.iniClassName.replace(/(^|\s+)btn(-[a-z0-9_-]*)?/gi,' ');var is_link=this.data.range.isOnAnchor();var sc=r.sc;var so=r.so;var ec=r.ec;var eo=r.eo;var nodes;if(!is_link){if(sc.tagName){sc=dom.firstChild(so?sc.childNodes[so]:sc);so=0;}else if(so!==sc.textContent.length){if(sc===ec){ec=sc=sc.splitText(so);eo-=so;}else{sc=sc.splitText(so);}
so=0;}
if(ec.tagName){ec=dom.lastChild(eo?ec.childNodes[eo-1]:ec);eo=ec.textContent.length;}else if(eo!==ec.textContent.length){ec.splitText(eo);}
nodes=dom.listBetween(sc,ec);if(dom.isVoid(sc)||dom.isImg(sc)){so=dom.listPrev(sc).length-1;sc=sc.parentNode;}
if(dom.isBR(ec)){eo=dom.listPrev(ec).length-1;ec=ec.parentNode;}else if(dom.isVoid(ec)||dom.isImg(sc)){eo=dom.listPrev(ec).length;ec=ec.parentNode;}
this.data.range=range.create(sc,so,ec,eo);$(editable).data("range",this.data.range);this.data.range.select();}else{nodes=dom.ancestor(sc,dom.isAnchor).childNodes;}
if(dom.isImg(sc)&&nodes.indexOf(sc)===-1){nodes.push(sc);}
if(nodes.length>1||dom.ancestor(nodes[0],dom.isImg)){var text="";this.data.images=[];for(var i=0;i<nodes.length;i++){if(dom.ancestor(nodes[i],dom.isImg)){this.data.images.push(dom.ancestor(nodes[i],dom.isImg));text+='[IMG]';}else if(!is_link&&nodes[i].nodeType===1){}else if(!is_link&&i===0){text+=nodes[i].textContent.slice(so,Infinity);}else if(!is_link&&i===nodes.length-1){text+=nodes[i].textContent.slice(0,eo);}else{text+=nodes[i].textContent;}}
this.data.text=text;}}
this.data.text=this.data.text.replace(/[ \t\r\n]+/g,' ');},start:function(){var self=this;this.$('input.link-style').prop('checked',false).first().prop('checked',true);if(this.data.iniClassName){_.each(this.$('input.link-style, select.link-style > option'),function(el){var $option=$(el);if($option.val()&&self.data.iniClassName.indexOf($option.val())>=0){if($option.is("input")){$option.prop("checked",true);}else{$option.parent().val($option.val());}}});}
if(this.data.url){var match=/mailto:(.+)/.exec(this.data.url);this.$('input[name="url"]').val(match?match[1]:this.data.url);}
this.opened().then(function(){if(self.__showDuplicateColorButtons){return;}
var colors=[];_.each(self.$('.o_btn_preview.o_link_dialog_color_item'),function(btn){var $btn=$(btn);var color=$btn.css('background-color');if(_.contains(colors,color)){$btn.hide();}else{colors.push(color);}});});this._adaptPreview();this.$('input:visible:first').focus();return this._super.apply(this,arguments);},save:function(){var data=this._getData();if(data===null){var $url=this.$('input[name="url"]');$url.closest('.form-group').addClass('o_has_error').find('.form-control, .custom-select').addClass('is-invalid');$url.focus();return $.Deferred().reject();}
this.data.text=data.label;this.data.url=data.url;this.data.className=data.classes.replace(/\s+/gi,' ').replace(/^\s+|\s+$/gi,'');if(data.classes.replace(/(^|[ ])(btn-secondary|btn-success|btn-primary|btn-info|btn-warning|btn-danger)([ ]|$)/gi,' ')){this.data.style={'background-color':'','color':''};}
this.data.isNewWindow=data.isNewWindow;this.final_data=this.data;return this._super.apply(this,arguments);},_adaptPreview:function(){var $preview=this.$("#link-preview");var data=this._getData();if(data===null){return;}
$preview.attr({target:data.isNewWindow?'_blank':'',href:data.url&&data.url.length?data.url:'#',class:data.classes.replace(/float-\w+/,'')+' o_btn_preview',}).html((data.label&&data.label.length)?data.label:data.url);},_getData:function(){var $url=this.$('input[name="url"]');var url=$url.val();var label=this.$('input[name="label"]').val()||url;if(label&&this.data.images){for(var i=0;i<this.data.images.length;i++){label=label.replace(/</,"&lt;").replace(/>/,"&gt;").replace(/\[IMG\]/,this.data.images[i].outerHTML);}}
if($url.prop('required')&&(!url||!$url[0].checkValidity())){return null;}
var style=this.$('input[name="link_style_color"]:checked').val()||'';var shape=this.$('select[name="link_style_shape"]').val()||'';var size=this.$('select[name="link_style_size"]').val()||'';var shapes=shape.split(',');var outline=shapes[0]==='outline';shape=shapes.slice(outline?1:0).join(' ');var classes=(this.data.className||'')
+(style?(' btn btn-'+(outline?'outline-':'')+style):'')
+(shape?(' '+shape):'')
+(size?(' btn-'+size):'');var isNewWindow=this.$('input[name="is_new_window"]').prop('checked');if(url.indexOf('@')>=0&&url.indexOf('mailto:')<0&&!url.match(/^http[s]?/i)){url=('mailto:'+url);}
return{label:label,url:url,classes:classes,isNewWindow:isNewWindow,};},_onAnyChange:function(){this._adaptPreview();},_onURLInput:function(ev){$(ev.currentTarget).closest('.form-group').removeClass('o_has_error').find('.form-control, .custom-select').removeClass('is-invalid');var isLink=$(ev.currentTarget).val().indexOf('@')<0;this.$('input[name="is_new_window"]').closest('.form-group').toggleClass('d-none',!isLink);},});var CropImageDialog=Dialog.extend({template:'web_editor.dialog.crop_image',xmlDependencies:Dialog.prototype.xmlDependencies.concat(['/web_editor/static/src/xml/editor.xml']),jsLibs:['/web_editor/static/lib/cropper/js/cropper.js',],cssLibs:['/web_editor/static/lib/cropper/css/cropper.css',],events:_.extend({},Dialog.prototype.events,{'click .o_crop_options [data-event]':'_onCropOptionClick',}),init:function(parent,options,$editable,media){this.media=media;this.$media=$(this.media);var src=this.$media.attr('src').split('?')[0];this.aspectRatioList=[[_t("Free"),'0/0',0],["16:9",'16/9',16/9],["4:3",'4/3',4/3],["1:1",'1/1',1],["2:3",'2/3',2/3],];this.imageData={imageSrc:src,originalSrc:this.$media.data('crop:originalSrc')||src,mimetype:this.$media.data('crop:mimetype')||(_.str.endsWith(src,'.png')?'image/png':'image/jpeg'),aspectRatio:this.$media.data('aspectRatio')||this.aspectRatioList[0][1],isExternalImage:src.substr(0,5)!=='data:'&&src[0]!=='/'&&src.indexOf(window.location.host)<0,};this.options=_.extend({title:_t("Crop Image"),buttons:this.imageData.isExternalImage?[{text:_t("Close"),close:true,}]:[{text:_t("Save"),classes:'btn-primary',click:this.save,},{text:_t("Discard"),close:true,}],},options||{});this._super(parent,this.options);},willStart:function(){var self=this;var def=this._super.apply(this,arguments);if(this.imageData.isExternalImage){return def;}
var defs=[def,ajax.loadLibs(this)];var params={};var isDBImage=false;var matchImageID=this.imageData.imageSrc.match(/^\/web\/image\/(\d+)/);if(matchImageID){params['image_id']=parseInt(matchImageID[1]);isDBImage=true;}else{var matchXmlID=this.imageData.imageSrc.match(/^\/web\/image\/([^/?]+)/);if(matchXmlID){params['xml_id']=matchXmlID[1];isDBImage=true;}}
if(isDBImage){defs.push(this._rpc({route:'/web_editor/get_image_info',params:params,}).then(function(res){_.extend(self.imageData,res);}));}
return $.when.apply($,defs);},start:function(){this.$cropperImage=this.$('.o_cropper_image');if(this.$cropperImage.length){var data=this.$media.data();var ratio=0;for(var i=0;i<this.aspectRatioList.length;i++){if(this.aspectRatioList[i][1]===data.aspectRatio){ratio=this.aspectRatioList[i][2];break;}}
this.$cropperImage.cropper({viewMode:1,autoCropArea:1,aspectRatio:ratio,data:_.pick(data,'x','y','width','height','rotate','scaleX','scaleY')});}
return this._super.apply(this,arguments);},destroy:function(){if(this.$cropperImage.length){this.$cropperImage.cropper('destroy');}
this._super.apply(this,arguments);},save:function(){var self=this;var cropperData=this.$cropperImage.cropper('getData');this.$media.addClass('o_cropped_img_to_save');this.$media.data('crop:resModel',this.options.res_model);this.$media.data('crop:resID',this.options.res_id);this.$media.data('crop:id',this.imageData.id);this.$media.data('crop:mimetype',this.imageData.mimetype);this.$media.data('crop:originalSrc',this.imageData.originalSrc);this.$media.attr('data-aspect-ratio',this.imageData.aspectRatio).data('aspectRatio',this.imageData.aspectRatio);_.each(cropperData,function(value,key){key=_.str.dasherize(key);self.$media.attr('data-'+key,value);self.$media.data(key,value);});var canvas=this.$cropperImage.cropper('getCroppedCanvas',{width:cropperData.width,height:cropperData.height,});this.$media.attr('src',canvas.toDataURL(this.imageData.mimetype));this.$media.trigger('content_changed');return this._super.apply(this,arguments);},_onCropOptionClick:function(ev){var $option=$(ev.currentTarget);var opt=$option.data('event');var value=$option.data('value');switch(opt){case'ratio':this.$cropperImage.cropper('reset');this.imageData.aspectRatio=$option.data('label');this.$cropperImage.cropper('setAspectRatio',value);break;case'zoom':case'rotate':case'reset':this.$cropperImage.cropper(opt,value);break;case'flip':var direction=value==='horizontal'?'x':'y';var scaleAngle=-$option.data(direction);$option.data(direction,scaleAngle);this.$cropperImage.cropper('scale'+direction.toUpperCase(),scaleAngle);break;}},});return{Dialog:Dialog,AltDialog:AltDialog,MediaDialog:MediaDialog,LinkDialog:LinkDialog,CropImageDialog:CropImageDialog,ImageWidget:ImageWidget,};});